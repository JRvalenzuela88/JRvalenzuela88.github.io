



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/api/apiRtutorial/">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-3.0.4">
    
    
      
        <title>API tutorials in R - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0028e27e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.dd00d4b7.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    <link rel="stylesheet" href="../../assets/fonts/clarke-regular.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#betfair-api-tutorials-in-r" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-header-nav__button md-logo">
          
            <img src="../../img/logo.svg" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                The Automation Hub
              </span>
              <span class="md-header-nav__topic">
                API tutorials in R
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      <div class="bf-nav md-flex__cell">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26"/>
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z"/>
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Home" class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../thirdPartyTools/overview/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../apiappkey/" title="API" class="md-tabs__link md-tabs__link--active">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../historicData/dataSources/" title="Historic Data" class="md-tabs__link">
          Historic Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../modelling/howToModel/" title="Modelling" class="md-tabs__link">
          Modelling
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-nav__button md-logo">
      
        <img src="../../img/logo.svg" width="48" height="48">
      
    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="The Automation Hub" class="md-nav__link">
      The Automation Hub
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/overview/" title="Tools Overview" class="md-nav__link">
      Tools Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Bet Angel Professional
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Bet Angel Professional
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngel/betAngel/" title="Overview - Bet Angel Pro" class="md-nav__link">
      Overview - Bet Angel Pro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelbeginners/" title="Bet Angel - A beginner's guide" class="md-nav__link">
      Bet Angel - A beginner's guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelintermediate/" title="Bet Angel - An intermediate guide" class="md-nav__link">
      Bet Angel - An intermediate guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngeladvanced/" title="Bet Angel - An advanced guide" class="md-nav__link">
      Bet Angel - An advanced guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelTippingAutomation/" title="Tipping automation" class="md-nav__link">
      Tipping automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Gruss Betting Assistant
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Gruss Betting Assistant
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/Gruss/Gruss/" title="Overview - Gruss" class="md-nav__link">
      Overview - Gruss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grusslSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Cymatic Trader
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Cymatic Trader
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/CymaticTrader/CymaticTrader/" title="Overview - Cymatic Trader" class="md-nav__link">
      Overview - Cymatic Trader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/cymaticTraderRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../apiappkey/" title="How to access the Betfair API" class="md-nav__link">
      How to access the Betfair API
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        API tutorials in R
      </label>
    
    <a href="./" title="API tutorials in R" class="md-nav__link md-nav__link--active">
      API tutorials in R
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#accessing-the-api-using-r" title="Accessing the API using R" class="md-nav__link">
    Accessing the API using R
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-r" title="Set up R" class="md-nav__link">
    Set up R
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#required-packages" title="Required Packages" class="md-nav__link">
    Required Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-to-betfair" title="Login to Betfair" class="md-nav__link">
    Login to Betfair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-event-ids" title="Finding Event IDs" class="md-nav__link">
    Finding Event IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-competition-ids" title="Finding Competition IDs" class="md-nav__link">
    Finding Competition IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-specific-markets" title="Finding Specific Markets" class="md-nav__link">
    Finding Specific Markets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-world-cup-odds-tutorial" title="Get World Cup Odds Tutorial" class="md-nav__link">
    Get World Cup Odds Tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#afl-odds-puller-tutorial" title="AFL Odds PulleR Tutorial" class="md-nav__link">
    AFL Odds PulleR Tutorial
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../apiPythontutorial/" title="API tutorial in Python" class="md-nav__link">
      API tutorial in Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Historic Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Historic Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/dataSources/" title="Historic Data Sources" class="md-nav__link">
      Historic Data Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/usingHistoricDataSite/" title="Downloading from the Historic Data site" class="md-nav__link">
      Downloading from the Historic Data site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/jsonToCsvTutorial/" title="JSON to CSV tutorial" class="md-nav__link">
      JSON to CSV tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Modelling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/howToModel/" title="Intro to modelling" class="md-nav__link">
      Intro to modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/howToModelTheAusOpen/" title="How to model the Australian Open" class="md-nav__link">
      How to model the Australian Open
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/AusOpenRTutorial/" title="Aus Open R Tutorial" class="md-nav__link">
      Aus Open R Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-nav__link">
      Aus Open Python Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/EPLmodelPart1/" title="EPL 01. Data acquisition & exploration" class="md-nav__link">
      EPL 01. Data acquisition & exploration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-nav__link">
      EPL 02. Data preparation & feature engineering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/EPLmodelPart3/" title="EPL 03. Model building & hyperparameter tuning" class="md-nav__link">
      EPL 03. Model building & hyperparameter tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/EPLmodelPart4/" title="EPL 04. Weekly predictions" class="md-nav__link">
      EPL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/AFLmodelPart1/" title="AFL 01. Data cleaning" class="md-nav__link">
      AFL 01. Data cleaning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/AFLmodelPart2/" title="AFL 02. Feature creation" class="md-nav__link">
      AFL 02. Feature creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/AFLmodelPart3/" title="AFL 03. Modelling" class="md-nav__link">
      AFL 03. Modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/AFLmodelPart4/" title="AFL 04. Weekly predictions" class="md-nav__link">
      AFL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modelling/brownlowModelTutorial/" title="Modelling the Brownlow Medal" class="md-nav__link">
      Modelling the Brownlow Medal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#accessing-the-api-using-r" title="Accessing the API using R" class="md-nav__link">
    Accessing the API using R
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-r" title="Set up R" class="md-nav__link">
    Set up R
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#required-packages" title="Required Packages" class="md-nav__link">
    Required Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#login-to-betfair" title="Login to Betfair" class="md-nav__link">
    Login to Betfair
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-event-ids" title="Finding Event IDs" class="md-nav__link">
    Finding Event IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-competition-ids" title="Finding Competition IDs" class="md-nav__link">
    Finding Competition IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-specific-markets" title="Finding Specific Markets" class="md-nav__link">
    Finding Specific Markets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-world-cup-odds-tutorial" title="Get World Cup Odds Tutorial" class="md-nav__link">
    Get World Cup Odds Tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#afl-odds-puller-tutorial" title="AFL Odds PulleR Tutorial" class="md-nav__link">
    AFL Odds PulleR Tutorial
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="betfair-api-tutorials-in-r">Betfair API tutorials in R<a class="headerlink" href="#betfair-api-tutorials-in-r" title="Permanent link">&para;</a></h1>
<p>Betfair's API can be easily traversed in R. It allows you to retrieve market information, create/cancel bets and manage your account. Here's a collection of easy to follow API tutorials in R:</p>
<ul>
<li><a href="/api/apiRtutorial/#accessing-the-api-using-r">Accessing the API using R</a></li>
<li><a href="/api/apiRtutorial/#get-world-cup-odds-tutorial">Get Worldcup Odds</a></li>
<li><a href="/api/apiRtutorial/#afl-odds-puller-tutorial">AFL Odds PulleR Tutorial</a></li>
</ul>
<hr />
<h2 id="accessing-the-api-using-r">Accessing the API using R<a class="headerlink" href="#accessing-the-api-using-r" title="Permanent link">&para;</a></h2>
<h3 id="set-up-r">Set up R<a class="headerlink" href="#set-up-r" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.r-project.org/about.html">What is R?</a></li>
<li><a href="https://cran.ms.unimelb.edu.au/">Download and install R</a> – get the language set up on your computer</li>
<li><a href="https://www.rstudio.com/">Download and install RStudio</a> – you’ll need a program to develop in, and this one is custom-designed to work with R</li>
</ul>
<hr />
<h3 id="required-packages">Required Packages<a class="headerlink" href="#required-packages" title="Permanent link">&para;</a></h3>
<p>Two R packages are required:</p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">abettor</span><span class="p">)</span>
</code></pre></div>
<p>The <a href="https://github.com/phillc73/abettor">abettor package can be downloaded here</a>. For an in-depth understanding of the package, have a read of the documentation. Instructions are also provided in the sample code.</p>
<hr />
<h3 id="login-to-betfair">Login to Betfair<a class="headerlink" href="#login-to-betfair" title="Permanent link">&para;</a></h3>
<p>To login to Betfair, replace the following dummy username, password and app key with your own.</p>
<div class="highlight"><pre><span></span><code><span class="n">abettor</span><span class="o">::</span><span class="nf">loginBF</span><span class="p">(</span><span class="n">username</span> <span class="o">=</span> <span class="s">&quot;betfair_username&quot;</span><span class="p">,</span>
                 <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;betfair_password&quot;</span><span class="p">,</span>
                 <span class="n">applicationKey</span> <span class="o">=</span> <span class="s">&quot;betfair_app_key&quot;</span><span class="p">)</span>
</code></pre></div>
<p>If you don't have a live app key for the API yet <a href="../../api/apiappkey">take a look at this page</a>.</p>
<hr />
<h3 id="finding-event-ids">Finding Event IDs<a class="headerlink" href="#finding-event-ids" title="Permanent link">&para;</a></h3>
<p>In order to find data for specific markets, you will first need to know the event ID. This is easily achieved with the <a href="https://github.com/phillc73/abettor">abettor package</a>. </p>
<p>To find the event IDs of events in the next 60 days:</p>
<div class="highlight"><pre><span></span><code><span class="n">abettor</span><span class="o">::</span><span class="nf">listEventTypes</span><span class="p">(</span><span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">60</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">)))</span>
</code></pre></div>
<p>This will return a DataFrame of the following structure:</p>
<div class="highlight"><pre><span></span><code><span class="n">eventType.id</span>    <span class="n">eventType.name</span>  <span class="n">marketCount</span>
<span class="m">1</span>   <span class="n">Soccer</span>  <span class="m">1193</span>
<span class="m">2</span>   <span class="n">Tennis</span>  <span class="m">2184</span>
<span class="m">7522</span>    <span class="n">Basketball</span>  <span class="m">1</span>
<span class="m">4</span>   <span class="n">Cricket</span> <span class="m">37</span>
<span class="m">7</span>   <span class="n">Horse</span> <span class="n">Racing</span>    <span class="m">509</span>
<span class="m">61420</span>   <span class="n">Australian</span> <span class="n">Rules</span>    <span class="m">31</span>
<span class="m">4339</span>    <span class="n">Greyhound</span> <span class="n">Racing</span>    <span class="m">527</span>
</code></pre></div>
<hr />
<h3 id="finding-competition-ids">Finding Competition IDs<a class="headerlink" href="#finding-competition-ids" title="Permanent link">&para;</a></h3>
<p>Once you have the event ID, the next logical step is to find the competition IDs for the event you want to get data for. For example, if you want to find the competition IDs for Australian Rules, you would use the following</p>
<div class="highlight"><pre><span></span><code><span class="n">abettor</span><span class="o">::</span><span class="nf">listCompetitions</span><span class="p">(</span>
  <span class="n">eventTypeIds</span> <span class="o">=</span> <span class="m">61420</span><span class="p">,</span>  <span class="c1">## AFL is eventTypeId 61420,</span>
  <span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">180</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">))</span> <span class="c1">## Look ahead until the next 180 days</span>
<span class="p">)</span>
</code></pre></div>
<p>This will return the following structured DataFrame:</p>
<div class="highlight"><pre><span></span><code><span class="n">competition.id</span>  <span class="n">competition.name</span>    <span class="n">marketCount</span> <span class="n">competitionRegion</span>
<span class="m">11516633</span>    <span class="n">Brownlow</span> <span class="n">Medal</span> <span class="m">2018</span> <span class="m">3</span>   <span class="n">AUS</span>
<span class="m">11897406</span>    <span class="n">AFL</span> <span class="m">78</span>  <span class="n">AUS</span>
</code></pre></div>
<hr />
<h3 id="finding-specific-markets">Finding Specific Markets<a class="headerlink" href="#finding-specific-markets" title="Permanent link">&para;</a></h3>
<p>The next logical step is to find the market that you are interested in. Furthering our example above, if you want the Match Odds for all Australian Rules games over the next 60 days, simply use the Competition ID from above in the following.</p>
<div class="highlight"><pre><span></span><code><span class="n">abettor</span><span class="o">::</span><span class="nf">listMarketCatalogue</span><span class="p">(</span>
  <span class="n">eventTypeIds</span> <span class="o">=</span> <span class="m">61420</span><span class="p">,</span>
  <span class="n">marketTypeCodes</span> <span class="o">=</span> <span class="s">&quot;MATCH_ODDS&quot;</span><span class="p">,</span> <span class="c1">## Restrict our search to Match Odds only, not other markets for the same match</span>
  <span class="n">competitionIds</span> <span class="o">=</span> <span class="m">11897406</span><span class="p">,</span>
  <span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">60</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">))</span>
</code></pre></div>
<p>This returns a large DataFrame object with each market, participants and associated odds.</p>
<hr />
<h2 id="get-world-cup-odds-tutorial">Get World Cup Odds Tutorial<a class="headerlink" href="#get-world-cup-odds-tutorial" title="Permanent link">&para;</a></h2>
<p>This tutorial walks you through the process of retrieving exchange odds for all the matches from the 2018 FIFA World Cup 2018. This can be modified for other sports and uses.</p>
<p>You can run this script in R.</p>
<div class="highlight"><pre><span></span><code><span class="c1">###################################################</span>
<span class="c1">### FIFA World Cup Datathon</span>
<span class="c1">### Betfair API Tutorial</span>
<span class="c1">###</span>
<span class="c1">### This script allows you to access the Betfair</span>
<span class="c1">### API and retrive exchange odds for all the </span>
<span class="c1">### matches from the upcoming FIFA World Cup 2018</span>
<span class="c1">###################################################</span>

<span class="c1">###################################################</span>
<span class="c1">### Setup</span>
<span class="c1">###################################################</span>

<span class="c1">## Loading required packages</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span> <span class="c1">## package for general data manipulation - https://www.tidyverse.org/</span>
<span class="nf">library</span><span class="p">(</span><span class="n">abettor</span><span class="p">)</span> <span class="c1">## wrapper package for the Betfair API - https://github.com/phillc73/abettor</span>

<span class="c1">## Enter your Betfair API Credentials below</span>
<span class="n">betfair_username</span> <span class="o">&lt;-</span> <span class="s">&quot;&quot;</span>
<span class="n">betfair_password</span> <span class="o">&lt;-</span> <span class="s">&quot;&quot;</span>
<span class="n">betfair_app_key</span> <span class="o">&lt;-</span> <span class="s">&quot;&quot;</span>

<span class="c1">## Login to Betfair - should return &quot;SUCCESS:&quot; on successful login</span>
<span class="n">betfair_login</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">loginBF</span><span class="p">(</span><span class="n">username</span> <span class="o">=</span> <span class="n">betfair_username</span><span class="p">,</span>
                                  <span class="n">password</span> <span class="o">=</span> <span class="n">betfair_password</span><span class="p">,</span>
                                  <span class="n">applicationKey</span> <span class="o">=</span> <span class="n">betfair_app_key</span><span class="p">)</span>

<span class="c1">###################################################</span>
<span class="c1">## Retrieving all soccer competitions for </span>
<span class="c1">## which markets are currently alive</span>
<span class="c1">## on the Betfair Exchange</span>
<span class="c1">###################################################</span>

<span class="n">all_soccer_markets</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">listCompetitions</span><span class="p">(</span>
  <span class="n">eventTypeIds</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span>  <span class="c1">## Soccer is eventTypeId 1,</span>
  <span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">60</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">))</span> <span class="c1">## Look ahead until the next 60 days</span>
  <span class="p">)</span>
<span class="c1">###################################################</span>
<span class="c1">## Retrieving the competition id</span>
<span class="c1">## for the 2018 World Cup </span>
<span class="c1">###################################################</span>

<span class="n">world_cup_competition_id</span> <span class="o">&lt;-</span> <span class="n">all_soccer_markets</span> <span class="o">%&gt;%</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">pull</span><span class="p">(</span><span class="n">competition</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Extracting the variable competition which is a nested data frame</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">filter</span><span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;2018 FIFA World Cup&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Filtering for the competition we need</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">pull</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">## Extracting the id for the competition we need</span>

<span class="c1">###################################################</span>
<span class="c1">## Obtaining all markets that are currently </span>
<span class="c1">## alive on the Betfair Exchange that belong to</span>
<span class="c1">## Competition ID that is mapped to the World Cup </span>
<span class="c1">###################################################</span>

<span class="n">all_world_cup_markets</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">listMarketCatalogue</span><span class="p">(</span>
  <span class="n">eventTypeIds</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="c1">## Soccer is eventTypeId 1</span>
  <span class="n">marketTypeCodes</span> <span class="o">=</span> <span class="s">&quot;MATCH_ODDS&quot;</span><span class="p">,</span> <span class="c1">## Restrict our search to Match Odds only, not other markets for the same match</span>
  <span class="n">competitionIds</span> <span class="o">=</span> <span class="n">world_cup_competition_id</span><span class="p">,</span> <span class="c1">## Restrict our search to World Cup matches only</span>
  <span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">60</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">))</span> <span class="c1">## Look ahead until the next 60 days</span>
<span class="p">)</span>

<span class="c1">###################################################</span>
<span class="c1">## Obtaining the current odds on the Betfair</span>
<span class="c1">## Exchange for all the markets that were </span>
<span class="c1">## obtained in the previous step (World Cup Matches)</span>
<span class="c1">###################################################</span>

<span class="c1">## Creating a vector/array of all market ids</span>
<span class="n">all_world_cup_markets_market_ids</span> <span class="o">&lt;-</span> <span class="n">all_world_cup_markets</span> <span class="o">%&gt;%</span>
  <span class="nf">pull</span><span class="p">(</span><span class="n">marketId</span><span class="p">)</span>

<span class="c1">## This function takes in a single market id and returns </span>
<span class="c1">## the current live odds on the Betfair Exchange for that market</span>
<span class="n">fetch_odds</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">market_id</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">## Retrieving market odds for a single market</span>
  <span class="n">odds</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">listMarketBook</span><span class="p">(</span><span class="n">marketIds</span> <span class="o">=</span> <span class="n">market_id</span><span class="p">,</span> <span class="c1">##Runs listMarketBook for given market_id</span>
                                  <span class="n">priceData</span> <span class="o">=</span> <span class="s">&quot;EX_BEST_OFFERS&quot;</span> <span class="c1">##Fetching the top 3 odds, EX_ALL_OFFERS fetches the entire depth of prices</span>
                                  <span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">pull</span><span class="p">(</span><span class="n">runners</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Extracting the runners field which has details of odds</span>
    <span class="nf">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="c1">## Converting to data frame from list</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">lastPriceTraded</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Extracting team and last matched odds</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">market_id</span> <span class="o">=</span> <span class="n">market_id</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Padding market id to the data to make it unique to this match</span>
    <span class="nf">bind_cols</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">outcome</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;o_1&quot;</span><span class="p">,</span><span class="s">&quot;o_2&quot;</span><span class="p">,</span><span class="s">&quot;o_3&quot;</span><span class="p">)))</span> <span class="o">%&gt;%</span> <span class="c1">## Creating outcome order to maintain consistency</span>
    <span class="nf">spread</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">lastPriceTraded</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Reshaping data to make it 1 row per match</span>
    <span class="nf">rename</span><span class="p">(</span><span class="n">team_1_odds</span> <span class="o">=</span> <span class="n">o_1</span><span class="p">,</span>
           <span class="n">team_2_odds</span> <span class="o">=</span> <span class="n">o_2</span><span class="p">,</span>
           <span class="n">draw_odds</span> <span class="o">=</span> <span class="n">o_3</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">##Renaming columns such that all matches can be combined into one data frame</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">market_id</span><span class="p">,</span> <span class="n">team_1_odds</span><span class="p">,</span> <span class="n">draw_odds</span><span class="p">,</span> <span class="n">team_2_odds</span><span class="p">)</span> <span class="c1">## Ordering columns in the right order</span>

  <span class="nf">return</span><span class="p">(</span><span class="n">odds</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">## The code below maps (or loops) each market id in the vector we created</span>
<span class="c1">## above through the fetch_odds function and retrives the market odds </span>
<span class="c1">## into a single data frame</span>
<span class="n">world_cup_market_odds</span> <span class="o">&lt;-</span> <span class="nf">map_df</span><span class="p">(</span><span class="n">.x</span> <span class="o">=</span> <span class="n">all_world_cup_markets_market_ids</span><span class="p">,</span> <span class="c1">##Iterate over market ids</span>
                                <span class="n">.f</span> <span class="o">=</span> <span class="n">fetch_odds</span> <span class="c1">## through function fetch_odds</span>
                                <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">bind_cols</span><span class="p">(</span><span class="n">all_world_cup_markets</span> <span class="o">%&gt;%</span> <span class="c1">## Merge with event names to identify which match odds it is</span>
              <span class="nf">pull</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">%&gt;%</span>
              <span class="nf">select</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">team_1</span> <span class="o">=</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&quot; v .*&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">),</span> <span class="c1">## Extracting team 1 from match name</span>
         <span class="n">team_2</span> <span class="o">=</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&quot;.* v &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="c1">## Extracing team 2 from match name</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">team_1</span><span class="p">,</span> <span class="n">team_2</span><span class="p">,</span> <span class="n">team_1_odds</span><span class="p">,</span> <span class="n">draw_odds</span><span class="p">,</span> <span class="n">team_2_odds</span><span class="p">)</span> <span class="c1">## Extracting columns that we need</span>

<span class="c1">## Writing output to csv file</span>
<span class="nf">write_csv</span><span class="p">(</span><span class="n">world_cup_market_odds</span><span class="p">,</span> <span class="s">&quot;world_cup_market_odds.csv&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="afl-odds-puller-tutorial">AFL Odds PulleR Tutorial<a class="headerlink" href="#afl-odds-puller-tutorial" title="Permanent link">&para;</a></h2>
<p>This tutorial walks you through the process of retrieving exchange odds for the the next round of Australian Rules.</p>
<p>You can run this script in R.</p>
<div class="highlight"><pre><span></span><code><span class="c1">###################################################</span>
<span class="c1">### AFL Model</span>
<span class="c1">### Betfair API Odds GrabbR</span>
<span class="c1">###</span>
<span class="c1">### This script allows you to access the Betfair</span>
<span class="c1">### API and retrive exchange odds for all the </span>
<span class="c1">### matches for the upcoming round of AFL games</span>
<span class="c1">###################################################</span>

<span class="c1">## Loading required packages</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span> <span class="c1">## package for general data manipulation - https://www.tidyverse.org/</span>
<span class="nf">library</span><span class="p">(</span><span class="n">abettor</span><span class="p">)</span> <span class="c1">## wrapper package for the Betfair API - https://github.com/phillc73/abettor</span>

<span class="c1">## Login to Betfair - should return &quot;SUCCESS:&quot; on successful login</span>
<span class="n">betfair_login</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">loginBF</span><span class="p">(</span><span class="n">username</span> <span class="o">=</span> <span class="s">&#39;your_username&#39;</span><span class="p">,</span>
                                  <span class="n">password</span> <span class="o">=</span> <span class="s">&#39;your_password&#39;</span><span class="p">,</span>
                                  <span class="n">applicationKey</span> <span class="o">=</span> <span class="s">&quot;your_betfair_app_key&quot;</span><span class="p">)</span>

<span class="c1">###################################################</span>
<span class="c1">## Retrieving all AFL competitions for </span>
<span class="c1">## which markets are currently alive</span>
<span class="c1">## on the Betfair Exchange</span>
<span class="c1">###################################################</span>

<span class="n">all_afl_markets</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">listCompetitions</span><span class="p">(</span>
  <span class="n">eventTypeIds</span> <span class="o">=</span> <span class="m">61420</span><span class="p">,</span>  <span class="c1">## AFL is eventTypeId 61420,</span>
  <span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">180</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">))</span> <span class="c1">## Look ahead until the next 180 days</span>
<span class="p">)</span>
<span class="c1">###################################################</span>
<span class="c1">## Retrieving the competition id</span>
<span class="c1">## for the regular AFL season</span>
<span class="c1">###################################################</span>

<span class="n">afl_competition_id</span> <span class="o">&lt;-</span> <span class="n">all_afl_markets</span> <span class="o">%&gt;%</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">pull</span><span class="p">(</span><span class="n">competition</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Extracting the variable competition which is a nested data frame</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">filter</span><span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;AFL&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Filtering for the competition we need</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">pull</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">## Extracting the id for the competition we need</span>

<span class="c1">###################################################</span>
<span class="c1">## Obtaining all markets that are currently </span>
<span class="c1">## alive on the Betfair Exchange that belong to</span>
<span class="c1">## Competition ID that is mapped to the AFL</span>
<span class="c1">###################################################</span>

<span class="n">all_afl_markets</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">listMarketCatalogue</span><span class="p">(</span>
  <span class="n">eventTypeIds</span> <span class="o">=</span> <span class="m">61420</span><span class="p">,</span> <span class="c1">## AFL is eventTypeId 61420</span>
  <span class="n">marketTypeCodes</span> <span class="o">=</span> <span class="s">&quot;MATCH_ODDS&quot;</span><span class="p">,</span> <span class="c1">## Restrict our search to Match Odds only, not other markets for the same match</span>
  <span class="n">competitionIds</span> <span class="o">=</span> <span class="n">afl_competition_id</span><span class="p">,</span> <span class="c1">## Restrict our search to AFL Matches Only</span>
  <span class="n">toDate</span> <span class="o">=</span> <span class="p">(</span><span class="nf">format</span><span class="p">(</span><span class="nf">Sys.time</span><span class="p">()</span> <span class="o">+</span> <span class="m">86400</span> <span class="o">*</span> <span class="m">60</span><span class="p">,</span> <span class="s">&quot;%Y-%m-%dT%TZ&quot;</span><span class="p">))</span> <span class="c1">## Look ahead until the next 60 days</span>
<span class="p">)</span>

<span class="c1">###################################################</span>
<span class="c1">## Obtaining the current odds on the Betfair</span>
<span class="c1">## Exchange for all the markets that were </span>
<span class="c1">## obtained in the previous step</span>
<span class="c1">###################################################</span>

<span class="c1">## Creating a vector/array of all market ids</span>
<span class="n">all_afl_markets_market_ids</span> <span class="o">&lt;-</span> <span class="n">all_afl_markets</span> <span class="o">%&gt;%</span>
  <span class="nf">pull</span><span class="p">(</span><span class="n">marketId</span><span class="p">)</span>

<span class="c1">## This function takes in a single market id and returns </span>
<span class="c1">## the current live odds on the Betfair Exchange for that market</span>
<span class="n">fetch_odds</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">market_id</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">## Retrieving market odds for a single market</span>
  <span class="n">odds</span> <span class="o">&lt;-</span> <span class="n">abettor</span><span class="o">::</span><span class="nf">listMarketBook</span><span class="p">(</span><span class="n">marketIds</span> <span class="o">=</span> <span class="n">market_id</span><span class="p">,</span> <span class="c1">##Runs listMarketBook for given market_id</span>
                                  <span class="n">priceData</span> <span class="o">=</span> <span class="s">&quot;EX_BEST_OFFERS&quot;</span> <span class="c1">##Fetching the top 3 odds, EX_ALL_OFFERS fetches the entire depth of prices</span>
  <span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">pull</span><span class="p">(</span><span class="n">runners</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Extracting the runners field which has details of odds</span>
    <span class="nf">as.data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="c1">## Converting to data frame from list</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">lastPriceTraded</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Extracting team and last matched odds</span>
    <span class="nf">mutate</span><span class="p">(</span><span class="n">market_id</span> <span class="o">=</span> <span class="n">market_id</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Padding market id to the data to make it unique to this match</span>
    <span class="nf">bind_cols</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">outcome</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;o_1&quot;</span><span class="p">,</span><span class="s">&quot;o_2&quot;</span><span class="p">)))</span> <span class="o">%&gt;%</span> <span class="c1">## Creating outcome order to maintain consistency</span>
    <span class="nf">spread</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">lastPriceTraded</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">## Reshaping data to make it 1 row per match</span>
    <span class="nf">rename</span><span class="p">(</span><span class="n">team_1_odds</span> <span class="o">=</span> <span class="n">o_1</span><span class="p">,</span>
           <span class="n">team_2_odds</span> <span class="o">=</span> <span class="n">o_2</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1">##Renaming columns such that all matches can be combined into one data frame</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">market_id</span><span class="p">,</span> <span class="n">team_1_odds</span><span class="p">,</span> <span class="n">team_2_odds</span><span class="p">)</span> <span class="c1">## Ordering columns in the right order</span>

  <span class="nf">return</span><span class="p">(</span><span class="n">odds</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">## The code below maps (or loops) each market id in the vector we created</span>
<span class="c1">## above through the fetch_odds function and retrives the market odds </span>
<span class="c1">## into a single data frame</span>
<span class="n">afl_market_odds</span> <span class="o">&lt;-</span> <span class="nf">map_df</span><span class="p">(</span><span class="n">.x</span> <span class="o">=</span> <span class="n">all_afl_markets_market_ids</span><span class="p">,</span> <span class="c1">##Iterate over market ids</span>
                                <span class="n">.f</span> <span class="o">=</span> <span class="n">fetch_odds</span> <span class="c1">## through function fetch_odds</span>
<span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">bind_cols</span><span class="p">(</span><span class="n">all_afl_markets</span> <span class="o">%&gt;%</span> <span class="c1">## Merge with event names to identify which match odds it is</span>
              <span class="nf">pull</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="o">%&gt;%</span>
              <span class="nf">select</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">team_1</span> <span class="o">=</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&quot; v .*&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">),</span> <span class="c1">## Extracting team 1 from match name</span>
         <span class="n">team_2</span> <span class="o">=</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">&quot;.* v &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="c1">## Extracing team 2 from match name</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">team_1</span><span class="p">,</span> <span class="n">team_2</span><span class="p">,</span> <span class="n">team_1_odds</span><span class="p">,</span> <span class="n">team_2_odds</span><span class="p">)</span> <span class="c1">## Extracting columns that we need</span>

<span class="c1">## Writing output to csv file</span>
<span class="nf">write_csv</span><span class="p">(</span><span class="n">afl_market_odds</span><span class="p">,</span> <span class="s">&quot;weekly_afl_odds.csv&quot;</span><span class="p">)</span>
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../apiappkey/" title="How to access the Betfair API" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How to access the Betfair API
              </span>
            </div>
          </a>
        
        
          <a href="../apiPythontutorial/" title="API tutorial in Python" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API tutorial in Python
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/Betfair_Aus" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/company/betfair-australia" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://facebook.com/betfairaustralia" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://youtube.com/user/betfairaus" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://github.com/betfair-datascientists" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
    <div class="bf-footer">
      <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
      <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its Responsible Gambling Code of Conduct and for South
      Australian residents by the South Australian Responsible Gambling Code of Practice.<br> Think! About your choices. Don’t chase your losses. Walk away. Gamble responsibly. Call Gambling Help 1800 858 858 <a href="https://gamblinghelponline.org.au">www.gamblinghelponline.org.au</a></p>
      <ul class="bf-links">
        <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
        <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
        <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
        <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
        <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
      </ul>
    </div>
  </div>
  <script src="https://js.adsrvr.org/up_loader.1.1.0.js"></script>
  <script>ttd_dom_ready(function(){"function"==typeof TTDUniversalPixelApi&&(new TTDUniversalPixelApi).init("y12d1ir",["8ml4f17"],"https://insight.adsrvr.org/track/up")})</script>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.07363bc3.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125973915-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>