



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/EPLmodelPart1/">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-3.0.4">
    
    
      
        <title>EPL 01. Data acquisition & exploration - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0028e27e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.dd00d4b7.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    <link rel="stylesheet" href="../../assets/fonts/clarke-regular.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#epl-machine-learning-walkthrough" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-header-nav__button md-logo">
          
            <img src="../../img/logo.svg" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                The Automation Hub
              </span>
              <span class="md-header-nav__topic">
                EPL 01. Data acquisition & exploration
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      <div class="bf-nav md-flex__cell">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26"/>
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z"/>
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Home" class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../thirdPartyTools/overview/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../api/apiappkey/" title="API" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../historicData/dataSources/" title="Historic Data" class="md-tabs__link">
          Historic Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../howToModel/" title="Modelling" class="md-tabs__link md-tabs__link--active">
          Modelling
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-nav__button md-logo">
      
        <img src="../../img/logo.svg" width="48" height="48">
      
    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="The Automation Hub" class="md-nav__link">
      The Automation Hub
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/overview/" title="Tools Overview" class="md-nav__link">
      Tools Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Bet Angel Professional
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Bet Angel Professional
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngel/betAngel/" title="Overview - Bet Angel Pro" class="md-nav__link">
      Overview - Bet Angel Pro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelbeginners/" title="Bet Angel - A beginner's guide" class="md-nav__link">
      Bet Angel - A beginner's guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelintermediate/" title="Bet Angel - An intermediate guide" class="md-nav__link">
      Bet Angel - An intermediate guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngeladvanced/" title="Bet Angel - An advanced guide" class="md-nav__link">
      Bet Angel - An advanced guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelTippingAutomation/" title="Tipping automation" class="md-nav__link">
      Tipping automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Gruss Betting Assistant
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Gruss Betting Assistant
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/Gruss/Gruss/" title="Overview - Gruss" class="md-nav__link">
      Overview - Gruss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grusslSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Cymatic Trader
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Cymatic Trader
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/CymaticTrader/CymaticTrader/" title="Overview - Cymatic Trader" class="md-nav__link">
      Overview - Cymatic Trader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/cymaticTraderRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiappkey/" title="How to access the Betfair API" class="md-nav__link">
      How to access the Betfair API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiRtutorial/" title="API tutorials in R" class="md-nav__link">
      API tutorials in R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiPythontutorial/" title="API tutorial in Python" class="md-nav__link">
      API tutorial in Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Historic Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Historic Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/dataSources/" title="Historic Data Sources" class="md-nav__link">
      Historic Data Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/usingHistoricDataSite/" title="Downloading from the Historic Data site" class="md-nav__link">
      Downloading from the Historic Data site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/csvTutorialMarketSummary/" title="JSON to CSV tutorial" class="md-nav__link">
      JSON to CSV tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Modelling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModel/" title="Intro to modelling" class="md-nav__link">
      Intro to modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModelTheAusOpen/" title="How to model the Australian Open" class="md-nav__link">
      How to model the Australian Open
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenRTutorial/" title="Aus Open R Tutorial" class="md-nav__link">
      Aus Open R Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-nav__link">
      Aus Open Python Tutorial
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        EPL 01. Data acquisition & exploration
      </label>
    
    <a href="./" title="EPL 01. Data acquisition & exploration" class="md-nav__link md-nav__link--active">
      EPL 01. Data acquisition & exploration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-data-acquisition-exploration" title="01. Data Acquisition &amp; Exploration" class="md-nav__link">
    01. Data Acquisition &amp; Exploration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-acquisition" title="Data Acquisition" class="md-nav__link">
    Data Acquisition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-exploration" title="Data Exploration" class="md-nav__link">
    Data Exploration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#home-ground-advantage" title="Home Ground Advantage" class="md-nav__link">
    Home Ground Advantage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findings" title="Findings" class="md-nav__link">
    Findings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-referee-home-ground-bias" title="Exploring Referee Home Ground Bias" class="md-nav__link">
    Exploring Referee Home Ground Bias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-correlation-with-margin" title="Variable Correlation With Margin" class="md-nav__link">
    Variable Correlation With Margin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysing-features" title="Analysing Features" class="md-nav__link">
    Analysing Features
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-nav__link">
      EPL 02. Data preparation & feature engineering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart3/" title="EPL 03. Model building & hyperparameter tuning" class="md-nav__link">
      EPL 03. Model building & hyperparameter tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart4/" title="EPL 04. Weekly predictions" class="md-nav__link">
      EPL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart1/" title="AFL 01. Data cleaning" class="md-nav__link">
      AFL 01. Data cleaning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart2/" title="AFL 02. Feature creation" class="md-nav__link">
      AFL 02. Feature creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart3/" title="AFL 03. Modelling" class="md-nav__link">
      AFL 03. Modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart4/" title="AFL 04. Weekly predictions" class="md-nav__link">
      AFL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../brownlowModelTutorial/" title="Modelling the Brownlow Medal" class="md-nav__link">
      Modelling the Brownlow Medal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-data-acquisition-exploration" title="01. Data Acquisition &amp; Exploration" class="md-nav__link">
    01. Data Acquisition &amp; Exploration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-acquisition" title="Data Acquisition" class="md-nav__link">
    Data Acquisition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-exploration" title="Data Exploration" class="md-nav__link">
    Data Exploration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#home-ground-advantage" title="Home Ground Advantage" class="md-nav__link">
    Home Ground Advantage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findings" title="Findings" class="md-nav__link">
    Findings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-referee-home-ground-bias" title="Exploring Referee Home Ground Bias" class="md-nav__link">
    Exploring Referee Home Ground Bias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-correlation-with-margin" title="Variable Correlation With Margin" class="md-nav__link">
    Variable Correlation With Margin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysing-features" title="Analysing Features" class="md-nav__link">
    Analysing Features
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="epl-machine-learning-walkthrough">EPL Machine Learning Walkthrough<a class="headerlink" href="#epl-machine-learning-walkthrough" title="Permanent link">&para;</a></h1>
<h2 id="01-data-acquisition-exploration">01. Data Acquisition &amp; Exploration<a class="headerlink" href="#01-data-acquisition-exploration" title="Permanent link">&para;</a></h2>
<p>Welcome to the first part of this Machine Learning Walkthrough. This tutorial will be made of two parts; how we actually acquired our data (programmatically) and exploring the data to find potential features to use in the <a href="/modelling/EPLmodelPart2">next tutorial</a>.</p>
<hr />
<h2 id="data-acquisition">Data Acquisition<a class="headerlink" href="#data-acquisition" title="Permanent link">&para;</a></h2>
<p>We will be grabbing our data from <a href="http://www.football-data.co.uk/englandm.php">football-data.co.uk</a>, which has an enormous amount of soccer data dating back to the 90s. They also generously allow us to use it for free! However, the data is in separate CSVs based on the season. That means we would need to manually download 20 different files if we wanted the past 20 seasons. Rather than do this laborious and boring task, let's create a function which downloads the files for us, and appends them all into one big CSV.</p>
<p>To do this, we will use BeautifulSoup, a Python library which helps to pull data from HTML and XML files. We will then define a function which collates all the data for us into one DataFrame.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Import Modules</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">data_preparation_functions</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">grab_epl_data</span><span class="p">():</span>
    <span class="c1"># Connect to football-data.co.uk</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://www.football-data.co.uk/englandm.php&quot;</span><span class="p">)</span>

    <span class="c1"># Create a BeautifulSoup object</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

    <span class="c1"># Find the tables with the links to the data in them.</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;cellspacing&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;800&#39;</span><span class="p">})[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">})[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Grab the urls for the csv files</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span>
    <span class="n">links_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">link_text</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">link_text</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span>

    <span class="n">data_urls</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create a list of links</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;http://www.football-data.co.uk/&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">links_text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;Premier League&#39;</span><span class="p">:</span>
            <span class="n">data_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Get rid of last 11 uls as these don&#39;t include match stats and odds, and we</span>
    <span class="c1"># only want from 2005 onwards</span>
    <span class="n">data_urls</span> <span class="o">=</span> <span class="n">data_urls</span><span class="p">[:</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Iterate over the urls</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">data_urls</span><span class="p">:</span>
        <span class="c1"># Get the season and make it a column</span>
        <span class="n">season</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting data for season </span><span class="si">{</span><span class="n">season</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Read the data from the url into a DataFrame</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>

        <span class="c1"># Create helpful columns like Day, Month, Year, Date etc. so that our data is clean</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">temp_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Day</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">Month</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">Year</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Month</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">Day</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">Year</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">))</span>
                          <span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

        <span class="c1"># Append the temp_df to the main df</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Drop all NAs</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished grabbing data.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">grab_epl_data</span><span class="p">()</span>
<span class="c1"># df.to_csv(&quot;data/epl_data.csv&quot;, index=False)</span>

    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1819</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1718</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1617</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1516</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1415</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1314</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1213</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1112</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1011</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0910</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0809</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0708</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0607</span>
    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0506</span>
    <span class="n">Finished</span> <span class="n">grabbing</span> <span class="n">data</span><span class="o">.</span>
</code></pre></div>
<p>Whenever we want to update our data (for example if we want the most recent Gameweek included), all we have to do is run that function and then save the data to a csv with the commented out line above.</p>
<hr />
<h2 id="data-exploration">Data Exploration<a class="headerlink" href="#data-exploration" title="Permanent link">&para;</a></h2>
<p>Now that we have our data, let's explore it. Let's first look at home team win rates since 2005 to see if there is a consistent trend. To get an idea of what our data looks like, we'll look at the tail of the dataset first.</p>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>AC</th>
<th>AF</th>
<th>AR</th>
<th>AS</th>
<th>AST</th>
<th>AY</th>
<th>AwayTeam</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Date</th>
<th>Day</th>
<th>Div</th>
<th>FTAG</th>
<th>FTHG</th>
<th>FTR</th>
<th>HC</th>
<th>HF</th>
<th>HR</th>
<th>HS</th>
<th>HST</th>
<th>HTAG</th>
<th>HTHG</th>
<th>HTR</th>
<th>HY</th>
<th>HomeTeam</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>Referee</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>season</th>
</tr>
</thead>
<tbody>
<tr>
<td>28</td>
<td>3.0</td>
<td>11.0</td>
<td>0.0</td>
<td>9.0</td>
<td>3.0</td>
<td>2.0</td>
<td>Crystal Palace</td>
<td>3.00</td>
<td>3.25</td>
<td>2.60</td>
<td>2.95</td>
<td>3.1</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.71</td>
<td>2.13</td>
<td>2.92</td>
<td>1.73</td>
<td>2.16</td>
<td>3.22</td>
<td>2.55</td>
<td>1.79</td>
<td>2.21</td>
<td>3.04</td>
<td>1.77</td>
<td>2.23</td>
<td>3.36</td>
<td>2.66</td>
<td>39.0</td>
<td>2018-08-26</td>
<td>26</td>
<td>E0</td>
<td>1.0</td>
<td>2.0</td>
<td>H</td>
<td>6.0</td>
<td>14.0</td>
<td>0.0</td>
<td>13.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>4.0</td>
<td>Watford</td>
<td>2.95</td>
<td>3.20</td>
<td>2.5</td>
<td>2.90</td>
<td>3.1</td>
<td>2.50</td>
<td>08</td>
<td>A Taylor</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>18</td>
<td>1819</td>
</tr>
<tr>
<td>27</td>
<td>5.0</td>
<td>8.0</td>
<td>0.0</td>
<td>15.0</td>
<td>3.0</td>
<td>1.0</td>
<td>Chelsea</td>
<td>1.66</td>
<td>4.00</td>
<td>5.75</td>
<td>1.67</td>
<td>3.8</td>
<td>5.25</td>
<td>42.0</td>
<td>22.0</td>
<td>1.00</td>
<td>1.92</td>
<td>1.88</td>
<td>1.67</td>
<td>2.18</td>
<td>1.71</td>
<td>3.90</td>
<td>5.25</td>
<td>2.01</td>
<td>1.95</td>
<td>1.71</td>
<td>2.28</td>
<td>1.76</td>
<td>4.17</td>
<td>5.75</td>
<td>40.0</td>
<td>2018-08-26</td>
<td>26</td>
<td>E0</td>
<td>2.0</td>
<td>1.0</td>
<td>A</td>
<td>4.0</td>
<td>16.0</td>
<td>0.0</td>
<td>6.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>3.0</td>
<td>Newcastle</td>
<td>1.70</td>
<td>3.75</td>
<td>5.0</td>
<td>1.67</td>
<td>3.8</td>
<td>5.25</td>
<td>08</td>
<td>P Tierney</td>
<td>1.67</td>
<td>4.0</td>
<td>5.5</td>
<td>18</td>
<td>1819</td>
</tr>
<tr>
<td>29</td>
<td>2.0</td>
<td>16.0</td>
<td>0.0</td>
<td>9.0</td>
<td>5.0</td>
<td>4.0</td>
<td>Tottenham</td>
<td>2.90</td>
<td>3.30</td>
<td>2.62</td>
<td>2.90</td>
<td>3.2</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.79</td>
<td>2.03</td>
<td>2.86</td>
<td>1.72</td>
<td>2.18</td>
<td>3.27</td>
<td>2.56</td>
<td>1.84</td>
<td>2.10</td>
<td>3.00</td>
<td>1.76</td>
<td>2.25</td>
<td>3.40</td>
<td>2.67</td>
<td>40.0</td>
<td>2018-08-27</td>
<td>27</td>
<td>E0</td>
<td>3.0</td>
<td>0.0</td>
<td>A</td>
<td>5.0</td>
<td>11.0</td>
<td>0.0</td>
<td>23.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>2.0</td>
<td>Man United</td>
<td>2.75</td>
<td>3.25</td>
<td>2.6</td>
<td>2.75</td>
<td>3.2</td>
<td>2.55</td>
<td>08</td>
<td>C Pawson</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>18</td>
<td>1819</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1"># Create Home Win, Draw Win and Away Win columns</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">homeWin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">),</span>
              <span class="n">draw</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">),</span>
              <span class="n">awayWin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">&lt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">))</span>
</code></pre></div>
<h3 id="home-ground-advantage">Home Ground Advantage<a class="headerlink" href="#home-ground-advantage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">win_rates</span> <span class="o">=</span> \
<span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;homeWin&#39;</span><span class="p">,</span> <span class="s1">&#39;draw&#39;</span><span class="p">,</span> <span class="s1">&#39;awayWin&#39;</span><span class="p">]])</span>

<span class="n">win_rates</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>homeWin</th>
<th>draw</th>
<th>awayWin</th>
</tr>
</thead>
<tbody>
<tr>
<td>season</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0506</td>
<td>0.505263</td>
<td>0.202632</td>
<td>0.292105</td>
</tr>
<tr>
<td>0607</td>
<td>0.477573</td>
<td>0.258575</td>
<td>0.263852</td>
</tr>
<tr>
<td>0708</td>
<td>0.463158</td>
<td>0.263158</td>
<td>0.273684</td>
</tr>
<tr>
<td>0809</td>
<td>0.453826</td>
<td>0.255937</td>
<td>0.290237</td>
</tr>
<tr>
<td>0910</td>
<td>0.507895</td>
<td>0.252632</td>
<td>0.239474</td>
</tr>
<tr>
<td>1011</td>
<td>0.471053</td>
<td>0.292105</td>
<td>0.236842</td>
</tr>
<tr>
<td>1112</td>
<td>0.450000</td>
<td>0.244737</td>
<td>0.305263</td>
</tr>
<tr>
<td>1213</td>
<td>0.433862</td>
<td>0.285714</td>
<td>0.280423</td>
</tr>
<tr>
<td>1314</td>
<td>0.472973</td>
<td>0.208108</td>
<td>0.318919</td>
</tr>
<tr>
<td>1415</td>
<td>0.453826</td>
<td>0.245383</td>
<td>0.300792</td>
</tr>
<tr>
<td>1516</td>
<td>0.414248</td>
<td>0.282322</td>
<td>0.303430</td>
</tr>
<tr>
<td>1617</td>
<td>0.492105</td>
<td>0.221053</td>
<td>0.286842</td>
</tr>
<tr>
<td>1718</td>
<td>0.455263</td>
<td>0.260526</td>
<td>0.284211</td>
</tr>
<tr>
<td>1819</td>
<td>0.466667</td>
<td>0.200000</td>
<td>0.333333</td>
</tr>
</tbody>
</table>
<h3 id="findings">Findings<a class="headerlink" href="#findings" title="Permanent link">&para;</a></h3>
<p>As we can see, winrates across home team wins, draws and away team wins are very consistent. It seems that the home team wins around 46-47% of the time, the draw happens about 25% of the time, and the away team wins about 27% of the time. Let's plot this DataFrame so that we can see the trend more easily.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set the style</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">home_line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win_rates</span><span class="o">.</span><span class="n">homeWin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Home Win Rate&#39;</span><span class="p">)</span>
<span class="n">away_line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win_rates</span><span class="o">.</span><span class="n">awayWin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Away Win Rate&#39;</span><span class="p">)</span>
<span class="n">draw_line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win_rates</span><span class="o">.</span><span class="n">draw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Draw Win Rate&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;season&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Win Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Win Rates&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Add the legend locations</span>
<span class="n">home_legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">home_line</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">home_legend</span><span class="p">)</span>
<span class="n">away_legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">away_line</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">away_legend</span><span class="p">)</span>
<span class="n">draw_legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">draw_line</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">))</span>
</code></pre></div>
<p><img alt="png" src="../img/output_10_0.png" /></p>
<p>As we can see, the winrates are relatively stable each season, except for in 14/15 when the home win rate drops dramatically.</p>
<p>Out of interest, let's also have a look at which team has the best home ground advantage. Let's define HGA as home win rate - away win rate. And then plot some of the big clubs' HGA against each other.</p>
<div class="highlight"><pre><span></span><code><span class="n">home_win_rates</span> <span class="o">=</span> \
<span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">homeWin</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">away_win_rates</span> <span class="o">=</span> \
<span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;AwayTeam&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">awayWin</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">hga</span> <span class="o">=</span> <span class="p">(</span><span class="n">home_win_rates</span> <span class="o">-</span> <span class="n">away_win_rates</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;HGA&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;HGA&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">hga</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>HomeTeam</th>
<th>HGA</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td>Fulham</td>
<td>0.315573</td>
</tr>
<tr>
<td>7</td>
<td>Brighton</td>
<td>0.304762</td>
</tr>
<tr>
<td>20</td>
<td>Man City</td>
<td>0.244980</td>
</tr>
<tr>
<td>14</td>
<td>Everton</td>
<td>0.241935</td>
</tr>
<tr>
<td>30</td>
<td>Stoke</td>
<td>0.241131</td>
</tr>
<tr>
<td>10</td>
<td>Charlton</td>
<td>0.236842</td>
</tr>
<tr>
<td>0</td>
<td>Arsenal</td>
<td>0.236140</td>
</tr>
<tr>
<td>27</td>
<td>Reading</td>
<td>0.234962</td>
</tr>
<tr>
<td>33</td>
<td>Tottenham</td>
<td>0.220207</td>
</tr>
<tr>
<td>21</td>
<td>Man United</td>
<td>0.215620</td>
</tr>
</tbody>
</table>
<p>So the club with the best HGA is Fulham - interesting. This is most likely because Fulham have won 100% of home games in 2018 so far which is skewing the mean. Let's see how the HGA for some of the big clubs based compare over seasons.</p>
<div class="highlight"><pre><span></span><code><span class="n">big_clubs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Liverpool&#39;</span><span class="p">,</span> <span class="s1">&#39;Man City&#39;</span><span class="p">,</span> <span class="s1">&#39;Man United&#39;</span><span class="p">,</span> <span class="s1">&#39;Chelsea&#39;</span><span class="p">,</span> <span class="s1">&#39;Arsenal&#39;</span><span class="p">]</span>
<span class="n">home_win_rates_5</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">HomeTeam</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">big_clubs</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">homeWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">away_win_rates_5</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">AwayTeam</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">big_clubs</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">awayWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">hga_top_5</span> <span class="o">=</span> <span class="n">home_win_rates_5</span> <span class="o">-</span> <span class="n">away_win_rates_5</span>

<span class="n">hga_top_5</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>HomeTeam</th>
<th>Arsenal</th>
<th>Chelsea</th>
<th>Liverpool</th>
<th>Man City</th>
<th>Man United</th>
</tr>
</thead>
<tbody>
<tr>
<td>season</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0506</td>
<td>0.421053</td>
<td>0.368421</td>
<td>0.263158</td>
<td>0.263158</td>
<td>0.052632</td>
</tr>
<tr>
<td>0607</td>
<td>0.263158</td>
<td>0.000000</td>
<td>0.421053</td>
<td>-0.052632</td>
<td>0.105263</td>
</tr>
<tr>
<td>0708</td>
<td>0.210526</td>
<td>-0.052632</td>
<td>0.157895</td>
<td>0.368421</td>
<td>0.368421</td>
</tr>
<tr>
<td>0809</td>
<td>0.105263</td>
<td>-0.157895</td>
<td>-0.052632</td>
<td>0.578947</td>
<td>0.210526</td>
</tr>
<tr>
<td>0910</td>
<td>0.368421</td>
<td>0.368421</td>
<td>0.421053</td>
<td>0.315789</td>
<td>0.263158</td>
</tr>
<tr>
<td>1011</td>
<td>0.157895</td>
<td>0.368421</td>
<td>0.368421</td>
<td>0.263158</td>
<td>0.684211</td>
</tr>
<tr>
<td>1112</td>
<td>0.157895</td>
<td>0.315789</td>
<td>-0.105263</td>
<td>0.421053</td>
<td>0.105263</td>
</tr>
<tr>
<td>1213</td>
<td>0.052632</td>
<td>0.105263</td>
<td>0.105263</td>
<td>0.248538</td>
<td>0.201754</td>
</tr>
<tr>
<td>1314</td>
<td>0.143275</td>
<td>0.251462</td>
<td>0.307018</td>
<td>0.362573</td>
<td>-0.026316</td>
</tr>
<tr>
<td>1415</td>
<td>0.131579</td>
<td>0.210526</td>
<td>0.105263</td>
<td>0.210526</td>
<td>0.421053</td>
</tr>
<tr>
<td>1516</td>
<td>0.210526</td>
<td>-0.105263</td>
<td>0.000000</td>
<td>0.263158</td>
<td>0.263158</td>
</tr>
<tr>
<td>1617</td>
<td>0.263158</td>
<td>0.210526</td>
<td>0.105263</td>
<td>-0.052632</td>
<td>-0.105263</td>
</tr>
<tr>
<td>1718</td>
<td>0.578947</td>
<td>0.052632</td>
<td>0.157895</td>
<td>0.000000</td>
<td>0.263158</td>
</tr>
<tr>
<td>1819</td>
<td>0.500000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.500000</td>
<td>0.500000</td>
</tr>
</tbody>
</table>
<p>Now let's plot it.</p>
<div class="highlight"><pre><span></span><code><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;HGA&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">hga_top_5</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;HGA&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeTeam&#39;</span><span class="p">:</span> <span class="s1">&#39;team&#39;</span><span class="p">}))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;HGA Among the top 5 clubs&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../img/output_17_0.png" /></p>
<p>The results here seem to be quite erratic, although it seems that Arsenal consistently has a HGA above 0.</p>
<p>Let's now look at the distributions of each of our columns. The odds columns are likely to be highly skewed, so we may have to account for this later.</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distribution for </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../img/output_20_0.png" /></p>
<p><img alt="png" src="../img/output_20_1.png" /></p>
<p><img alt="png" src="../img/output_20_2.png" /></p>
<p><img alt="png" src="../img/output_20_3.png" /></p>
<p><img alt="png" src="../img/output_20_4.png" /></p>
<p><img alt="png" src="../img/output_20_5.png" /></p>
<p><img alt="png" src="../img/output_20_6.png" /></p>
<p><img alt="png" src="../img/output_20_7.png" /></p>
<p><img alt="png" src="../img/output_20_8.png" /></p>
<p><img alt="png" src="../img/output_20_9.png" /></p>
<p><img alt="png" src="../img/output_20_10.png" /></p>
<p><img alt="png" src="../img/output_20_11.png" /></p>
<p><img alt="png" src="../img/output_20_12.png" /></p>
<p><img alt="png" src="../img/output_20_13.png" /></p>
<p><img alt="png" src="../img/output_20_14.png" /></p>
<p><img alt="png" src="../img/output_20_15.png" /></p>
<p><img alt="png" src="../img/output_20_16.png" /></p>
<p><img alt="png" src="../img/output_20_17.png" /></p>
<p><img alt="png" src="../img/output_20_18.png" /></p>
<p><img alt="png" src="../img/output_20_19.png" /></p>
<p><img alt="png" src="../img/output_20_20.png" /></p>
<p><img alt="png" src="../img/output_20_21.png" /></p>
<p><img alt="png" src="../img/output_20_22.png" /></p>
<p><img alt="png" src="../img/output_20_23.png" /></p>
<p><img alt="png" src="../img/output_20_24.png" /></p>
<p><img alt="png" src="../img/output_20_25.png" /></p>
<p><img alt="png" src="../img/output_20_26.png" /></p>
<p><img alt="png" src="../img/output_20_27.png" /></p>
<p><img alt="png" src="../img/output_20_28.png" /></p>
<p><img alt="png" src="../img/output_20_29.png" /></p>
<p><img alt="png" src="../img/output_20_30.png" /></p>
<p><img alt="png" src="../img/output_20_31.png" /></p>
<p><img alt="png" src="../img/output_20_32.png" /></p>
<p><img alt="png" src="../img/output_20_33.png" /></p>
<p><img alt="png" src="../img/output_20_34.png" /></p>
<p><img alt="png" src="../img/output_20_35.png" /></p>
<p><img alt="png" src="../img/output_20_36.png" /></p>
<p><img alt="png" src="../img/output_20_37.png" /></p>
<p><img alt="png" src="../img/output_20_38.png" /></p>
<p><img alt="png" src="../img/output_20_39.png" /></p>
<p><img alt="png" src="../img/output_20_40.png" /></p>
<p><img alt="png" src="../img/output_20_41.png" /></p>
<p><img alt="png" src="../img/output_20_42.png" /></p>
<p><img alt="png" src="../img/output_20_43.png" /></p>
<p><img alt="png" src="../img/output_20_44.png" /></p>
<p><img alt="png" src="../img/output_20_45.png" /></p>
<p><img alt="png" src="../img/output_20_46.png" /></p>
<p><img alt="png" src="../img/output_20_47.png" /></p>
<p><img alt="png" src="../img/output_20_48.png" /></p>
<p><img alt="png" src="../img/output_20_49.png" /></p>
<p><img alt="png" src="../img/output_20_50.png" /></p>
<p><img alt="png" src="../img/output_20_51.png" /></p>
<p><img alt="png" src="../img/output_20_52.png" /></p>
<hr />
<h2 id="exploring-referee-home-ground-bias">Exploring Referee Home Ground Bias<a class="headerlink" href="#exploring-referee-home-ground-bias" title="Permanent link">&para;</a></h2>
<p>What may be of interest is whether certain referees are correlated with the home team winning more often. Let's explore referee home ground bias for referees for the top 10 Referees based on games.</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overall Home Win Rate: </span><span class="si">{:.4}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">homeWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>

<span class="c1"># Get the top 10 refs based on games</span>
<span class="n">top_10_refs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Referee</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>

<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Referee</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_10_refs</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Referee&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">homeWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
    Overall Home Win Rate: 46.55%</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Referee
L Mason          0.510373
C Foy            0.500000
M Clattenburg    0.480000
M Jones          0.475248
P Dowd           0.469880
M Atkinson       0.469565
M Oliver         0.466019
H Webb           0.456604
A Marriner       0.455516
M Dean           0.442049
Name: homeWin, dtype: float64
</code></pre></div>

<p>It seems that L Mason may be the most influenced by the home crowd. Whilst the overall home win rate is 46.5%, the home win rate when he is the Referee is 51%. However it should be noted that this doesn't mean that he causes the win through bias. It could just be that he referees the best clubs, so naturally their home win rate is high.</p>
<hr />
<h2 id="variable-correlation-with-margin">Variable Correlation With Margin<a class="headerlink" href="#variable-correlation-with-margin" title="Permanent link">&para;</a></h2>
<p>Let's now explore different variables' relationships with margin. First, we'll create a margin column, then we will pick a few different variables to look at the correlations amongst each other, using a correlation heatmap.</p>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;FTHG&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;FTAG&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">stat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">,</span> <span class="s1">&#39;AF&#39;</span><span class="p">,</span> <span class="s1">&#39;AR&#39;</span><span class="p">,</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;AST&#39;</span><span class="p">,</span> <span class="s1">&#39;AY&#39;</span><span class="p">,</span> <span class="s1">&#39;HC&#39;</span><span class="p">,</span> <span class="s1">&#39;HF&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">,</span> <span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;HST&#39;</span><span class="p">,</span> <span class="s1">&#39;HTR&#39;</span><span class="p">,</span> <span class="s1">&#39;HY&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">]</span>

<span class="n">stat_correlations</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">stat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">stat_correlations</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

    <span class="n">AST</span>      <span class="o">-</span><span class="mf">0.345703</span>
    <span class="n">AS</span>       <span class="o">-</span><span class="mf">0.298665</span>
    <span class="n">HY</span>       <span class="o">-</span><span class="mf">0.153806</span>
    <span class="n">HR</span>       <span class="o">-</span><span class="mf">0.129393</span>
    <span class="n">AC</span>       <span class="o">-</span><span class="mf">0.073204</span>
    <span class="n">HF</span>       <span class="o">-</span><span class="mf">0.067469</span>
    <span class="n">AF</span>        <span class="mf">0.005474</span>
    <span class="n">AY</span>        <span class="mf">0.013746</span>
    <span class="n">HC</span>        <span class="mf">0.067433</span>
    <span class="n">AR</span>        <span class="mf">0.103528</span>
    <span class="n">HS</span>        <span class="mf">0.275847</span>
    <span class="n">HST</span>       <span class="mf">0.367591</span>
    <span class="n">margin</span>    <span class="mf">1.000000</span>
    <span class="n">Name</span><span class="p">:</span> <span class="n">margin</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></div>
<p>Unsurprisingly, Home Shots on Target correlate the most with Margin, and Away Reds is also high. What is surprising is that Home Yellows has quite a strong negative correlation with margin - this may be because players will play more aggresively when they are losing to try and get the lead back, and hence receive more yellow cards.</p>
<p>Let's now look at the heatmap between variables.</p>
<div class="highlight"><pre><span></span><code><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">stat_correlations</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x220a4227048</span><span class="o">&gt;</span>
</code></pre></div>
<p><img alt="png" src="../img/output_28_1.png" /></p>
<hr />
<h2 id="analysing-features">Analysing Features<a class="headerlink" href="#analysing-features" title="Permanent link">&para;</a></h2>
<p>What we are really interested in, is how our features (creating in the next tutorial), correlate with winning. We will skip ahead here and use a function to create our features for us, and then examine how the moving averages/different features correlate with winning.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a cleaned df of all of our data</span>
<span class="n">pre_features_df</span> <span class="o">=</span> <span class="n">create_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Create our features</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">create_feature_df</span><span class="p">(</span><span class="n">pre_features_df</span><span class="p">)</span>
    <span class="n">Creating</span> <span class="nb">all</span> <span class="n">games</span> <span class="n">feature</span> <span class="n">DataFrame</span>

    <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">wardj</span>\<span class="n">Documents</span>\<span class="n">Betfair</span> <span class="n">Public</span> <span class="n">Github</span>\<span class="n">predictive</span><span class="o">-</span><span class="n">models</span>\<span class="n">epl</span>\<span class="n">data_preparation_functions</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">419</span><span class="p">:</span> <span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">value</span> <span class="n">encountered</span> <span class="ow">in</span> <span class="n">double_scalars</span>
      <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">eloAgainst</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">goalsForOrAgainstCol</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">eloAgainst</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>

    <span class="n">Creating</span> <span class="n">stats</span> <span class="n">feature</span> <span class="n">DataFrame</span>
    <span class="n">Creating</span> <span class="n">odds</span> <span class="n">feature</span> <span class="n">DataFrame</span>
    <span class="n">Creating</span> <span class="n">market</span> <span class="n">values</span> <span class="n">feature</span> <span class="n">DataFrame</span>
    <span class="n">Filling</span> <span class="n">NAs</span>
    <span class="n">Merging</span> <span class="n">stats</span><span class="p">,</span> <span class="n">odds</span> <span class="ow">and</span> <span class="n">market</span> <span class="n">values</span> <span class="n">into</span> <span class="n">one</span> <span class="n">features</span> <span class="n">DataFrame</span>
    <span class="n">Complete</span><span class="o">.</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">features</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre_features_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">FTAG</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">]]</span>
                           <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">features</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">margin</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]</span>

    <span class="n">margin</span>                     <span class="mf">1.000000</span>
    <span class="n">f_awayOdds</span>                 <span class="mf">0.413893</span>
    <span class="n">f_totalMktH</span><span class="o">%</span>               <span class="mf">0.330420</span>
    <span class="n">f_defMktH</span><span class="o">%</span>                 <span class="mf">0.325392</span>
    <span class="n">f_eloAgainstAway</span>           <span class="mf">0.317853</span>
    <span class="n">f_eloForHome</span>               <span class="mf">0.317853</span>
    <span class="n">f_midMktH</span><span class="o">%</span>                 <span class="mf">0.316080</span>
    <span class="n">f_attMktH</span><span class="o">%</span>                 <span class="mf">0.312262</span>
    <span class="n">f_sizeOfHandicapAway</span>       <span class="mf">0.301667</span>
    <span class="n">f_goalsForHome</span>             <span class="mf">0.298930</span>
    <span class="n">f_wtEloGoalsForHome</span>        <span class="mf">0.297157</span>
    <span class="n">f_shotsForHome</span>             <span class="mf">0.286239</span>
    <span class="n">f_cornersForHome</span>           <span class="mf">0.279917</span>
    <span class="n">f_gkMktH</span><span class="o">%</span>                  <span class="mf">0.274732</span>
    <span class="n">f_homeWinPc38Away</span>          <span class="mf">0.271326</span>
    <span class="n">f_homeWinPc38Home</span>          <span class="mf">0.271326</span>
    <span class="n">f_wtEloGoalsAgainstAway</span>    <span class="mf">0.269663</span>
    <span class="n">f_goalsAgainstAway</span>         <span class="mf">0.258418</span>
    <span class="n">f_cornersAgainstAway</span>       <span class="mf">0.257148</span>
    <span class="n">f_drawOdds</span>                 <span class="mf">0.256807</span>
    <span class="n">Name</span><span class="p">:</span> <span class="n">margin</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></div>
<p>As we can see away odds is most highly correlated to margin. This makes sense, as odds generally have most/all information included in the price. What is interesting is that elo seems to also be highly correlated, which is good news for our elo model that we made. Similarly, weighted goals and the the value of the defence relative to other teams ('defMktH%' etc.) is strongly correlated to margin.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Aus Open Python Tutorial
              </span>
            </div>
          </a>
        
        
          <a href="../EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                EPL 02. Data preparation & feature engineering
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/Betfair_Aus" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/company/betfair-australia" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://facebook.com/betfairaustralia" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://youtube.com/user/betfairaus" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://github.com/betfair-datascientists" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
    <div class="bf-footer">
      <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
      <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its Responsible Gambling Code of Conduct and for South
      Australian residents by the South Australian Responsible Gambling Code of Practice.<br> Think! About your choices. Don’t chase your losses. Walk away. Gamble responsibly. Call Gambling Help 1800 858 858 <a href="https://gamblinghelponline.org.au">www.gamblinghelponline.org.au</a></p>
      <ul class="bf-links">
        <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
        <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
        <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
        <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
        <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
      </ul>
    </div>
  </div>
  <script src="https://js.adsrvr.org/up_loader.1.1.0.js"></script>
  <script>ttd_dom_ready(function(){"function"==typeof TTDUniversalPixelApi&&(new TTDUniversalPixelApi).init("y12d1ir",["8ml4f17"],"https://insight.adsrvr.org/track/up")})</script>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.07363bc3.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125973915-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>