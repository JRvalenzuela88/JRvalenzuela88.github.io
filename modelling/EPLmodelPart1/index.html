



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/EPLmodelPart1/">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>EPL 01. Data acquisition & exploration - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.834e7605.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.dd00d4b7.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    <link rel="stylesheet" href="../../assets/fonts/clarke-regular.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#epl-machine-learning-walkthrough" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-header-nav__button md-logo">
          
            <img src="../../img/logo.svg" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                The Automation Hub
              </span>
              <span class="md-header-nav__topic">
                EPL 01. Data acquisition & exploration
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      <div class="bf-nav md-flex__cell">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26"/>
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z"/>
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Home" class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../thirdPartyTools/overview/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../api/apiappkey/" title="API" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../historicData/dataSources/" title="Historic Data" class="md-tabs__link">
          Historic Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../howToModel/" title="Modelling" class="md-tabs__link md-tabs__link--active">
          Modelling
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-nav__button md-logo">
      
        <img src="../../img/logo.svg" width="48" height="48">
      
    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="The Automation Hub" class="md-nav__link">
      The Automation Hub
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/overview/" title="Tools Overview" class="md-nav__link">
      Tools Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Bet Angel Professional
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Bet Angel Professional
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngel/betAngel/" title="Overview - Bet Angel Pro" class="md-nav__link">
      Overview - Bet Angel Pro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelbeginners/" title="Bet Angel - A beginner's guide" class="md-nav__link">
      Bet Angel - A beginner's guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelintermediate/" title="Bet Angel - An intermediate guide" class="md-nav__link">
      Bet Angel - An intermediate guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngeladvanced/" title="Bet Angel - An advanced guide" class="md-nav__link">
      Bet Angel - An advanced guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelTippingAutomation/" title="Tipping automation" class="md-nav__link">
      Tipping automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Gruss Betting Assistant
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Gruss Betting Assistant
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/Gruss/Gruss/" title="Overview - Gruss" class="md-nav__link">
      Overview - Gruss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grusslSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Cymatic Trader
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Cymatic Trader
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/CymaticTrader/CymaticTrader/" title="Overview - Cymatic Trader" class="md-nav__link">
      Overview - Cymatic Trader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/cymaticTraderRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiappkey/" title="How to access the Betfair API" class="md-nav__link">
      How to access the Betfair API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiRtutorial/" title="API tutorials in R" class="md-nav__link">
      API tutorials in R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiPythontutorial/" title="API tutorial in Python" class="md-nav__link">
      API tutorial in Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Historic Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Historic Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/dataSources/" title="Historic Data Sources" class="md-nav__link">
      Historic Data Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/usingHistoricDataSite/" title="Downloading from the Historic Data site" class="md-nav__link">
      Downloading from the Historic Data site
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Modelling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModel/" title="Intro to modelling" class="md-nav__link">
      Intro to modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModelTheAusOpen/" title="How to model the Australian Open" class="md-nav__link">
      How to model the Australian Open
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenRTutorial/" title="Aus Open R Tutorial" class="md-nav__link">
      Aus Open R Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-nav__link">
      Aus Open Python Tutorial
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        EPL 01. Data acquisition & exploration
      </label>
    
    <a href="./" title="EPL 01. Data acquisition & exploration" class="md-nav__link md-nav__link--active">
      EPL 01. Data acquisition & exploration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-data-acquisition-exploration" title="01. Data Acquisition &amp; Exploration" class="md-nav__link">
    01. Data Acquisition &amp; Exploration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-acquisition" title="Data Acquisition" class="md-nav__link">
    Data Acquisition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-exploration" title="Data Exploration" class="md-nav__link">
    Data Exploration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#home-ground-advantage" title="Home Ground Advantage" class="md-nav__link">
    Home Ground Advantage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findings" title="Findings" class="md-nav__link">
    Findings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-referee-home-ground-bias" title="Exploring Referee Home Ground Bias" class="md-nav__link">
    Exploring Referee Home Ground Bias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-correlation-with-margin" title="Variable Correlation With Margin" class="md-nav__link">
    Variable Correlation With Margin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysing-features" title="Analysing Features" class="md-nav__link">
    Analysing Features
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-nav__link">
      EPL 02. Data preparation & feature engineering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart3/" title="EPL 03. Model building & hyperparameter tuning" class="md-nav__link">
      EPL 03. Model building & hyperparameter tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart4/" title="EPL 04. Weekly predictions" class="md-nav__link">
      EPL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart1/" title="AFL 01. Data cleaning" class="md-nav__link">
      AFL 01. Data cleaning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart2/" title="AFL 02. Feature creation" class="md-nav__link">
      AFL 02. Feature creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart3/" title="AFL 03. Modelling" class="md-nav__link">
      AFL 03. Modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart4/" title="AFL 04. Weekly predictions" class="md-nav__link">
      AFL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../brownlowModelTutorial/" title="Modelling the Brownlow Medal" class="md-nav__link">
      Modelling the Brownlow Medal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#01-data-acquisition-exploration" title="01. Data Acquisition &amp; Exploration" class="md-nav__link">
    01. Data Acquisition &amp; Exploration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-acquisition" title="Data Acquisition" class="md-nav__link">
    Data Acquisition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-exploration" title="Data Exploration" class="md-nav__link">
    Data Exploration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#home-ground-advantage" title="Home Ground Advantage" class="md-nav__link">
    Home Ground Advantage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findings" title="Findings" class="md-nav__link">
    Findings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-referee-home-ground-bias" title="Exploring Referee Home Ground Bias" class="md-nav__link">
    Exploring Referee Home Ground Bias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-correlation-with-margin" title="Variable Correlation With Margin" class="md-nav__link">
    Variable Correlation With Margin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysing-features" title="Analysing Features" class="md-nav__link">
    Analysing Features
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="epl-machine-learning-walkthrough">EPL Machine Learning Walkthrough<a class="headerlink" href="#epl-machine-learning-walkthrough" title="Permanent link">&para;</a></h1>
<h2 id="01-data-acquisition-exploration">01. Data Acquisition &amp; Exploration<a class="headerlink" href="#01-data-acquisition-exploration" title="Permanent link">&para;</a></h2>
<p>Welcome to the first part of this Machine Learning Walkthrough. This tutorial will be made of two parts; how we actually acquired our data (programmatically) and exploring the data to find potential features to use in the <a href="/modelling/EPLmodelPart2">next tutorial</a>.</p>
<hr />
<h2 id="data-acquisition">Data Acquisition<a class="headerlink" href="#data-acquisition" title="Permanent link">&para;</a></h2>
<p>We will be grabbing our data from <a href="http://www.football-data.co.uk/englandm.php">football-data.co.uk</a>, which has an enormous amount of soccer data dating back to the 90s. They also generously allow us to use it for free! However, the data is in separate CSVs based on the season. That means we would need to manually download 20 different files if we wanted the past 20 seasons. Rather than do this laborious and boring task, let's create a function which downloads the files for us, and appends them all into one big CSV.</p>
<p>To do this, we will use BeautifulSoup, a Python library which helps to pull data from HTML and XML files. We will then define a function which collates all the data for us into one DataFrame.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Import Modules</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">pandas</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">pd</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">requests</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">bs4</span> <span style="color: #008000; font-weight: bold">import</span> BeautifulSoup
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">datetime</span>
pd<span style="color: #666666">.</span>set_option(<span style="color: #BA2121">&#39;display.max_columns&#39;</span>, <span style="color: #666666">100</span>)
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">seaborn</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">sns</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>
<span style="color: #666666">%</span>matplotlib inline
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">data_preparation_functions</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">grab_epl_data</span>():
    <span style="color: #408080; font-style: italic"># Connect to football-data.co.uk</span>
    res <span style="color: #666666">=</span> requests<span style="color: #666666">.</span>get(<span style="color: #BA2121">&quot;http://www.football-data.co.uk/englandm.php&quot;</span>)

    <span style="color: #408080; font-style: italic"># Create a BeautifulSoup object</span>
    soup <span style="color: #666666">=</span> BeautifulSoup(res<span style="color: #666666">.</span>content, <span style="color: #BA2121">&#39;lxml&#39;</span>)

    <span style="color: #408080; font-style: italic"># Find the tables with the links to the data in them.</span>
    table <span style="color: #666666">=</span> soup<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">&#39;table&#39;</span>, {<span style="color: #BA2121">&#39;align&#39;</span>: <span style="color: #BA2121">&#39;center&#39;</span>, <span style="color: #BA2121">&#39;cellspacing&#39;</span>: <span style="color: #BA2121">&#39;0&#39;</span>, <span style="color: #BA2121">&#39;width&#39;</span>: <span style="color: #BA2121">&#39;800&#39;</span>})[<span style="color: #666666">1</span>]
    body <span style="color: #666666">=</span> table<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">&#39;td&#39;</span>, {<span style="color: #BA2121">&#39;valign&#39;</span>: <span style="color: #BA2121">&#39;top&#39;</span>})[<span style="color: #666666">1</span>]

    <span style="color: #408080; font-style: italic"># Grab the urls for the csv files</span>
    links <span style="color: #666666">=</span> [link<span style="color: #666666">.</span>get(<span style="color: #BA2121">&#39;href&#39;</span>) <span style="color: #008000; font-weight: bold">for</span> link <span style="color: #AA22FF; font-weight: bold">in</span> body<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">&#39;a&#39;</span>)]
    links_text <span style="color: #666666">=</span> [link_text<span style="color: #666666">.</span>text <span style="color: #008000; font-weight: bold">for</span> link_text <span style="color: #AA22FF; font-weight: bold">in</span> body<span style="color: #666666">.</span>find_all(<span style="color: #BA2121">&#39;a&#39;</span>)]

    data_urls <span style="color: #666666">=</span> []

    <span style="color: #408080; font-style: italic"># Create a list of links</span>
    prefix <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://www.football-data.co.uk/&#39;</span>
    <span style="color: #008000; font-weight: bold">for</span> i, text <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(links_text):
        <span style="color: #008000; font-weight: bold">if</span> text <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;Premier League&#39;</span>:
            data_urls<span style="color: #666666">.</span>append(prefix <span style="color: #666666">+</span> links[i])

    <span style="color: #408080; font-style: italic"># Get rid of last 11 uls as these don&#39;t include match stats and odds, and we</span>
    <span style="color: #408080; font-style: italic"># only want from 2005 onwards</span>
    data_urls <span style="color: #666666">=</span> data_urls[:<span style="color: #666666">-12</span>]

    df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>DataFrame()

    <span style="color: #408080; font-style: italic"># Iterate over the urls</span>
    <span style="color: #008000; font-weight: bold">for</span> url <span style="color: #AA22FF; font-weight: bold">in</span> data_urls:
        <span style="color: #408080; font-style: italic"># Get the season and make it a column</span>
        season <span style="color: #666666">=</span> url<span style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;/&#39;</span>)[<span style="color: #666666">4</span>]

        <span style="color: #008000; font-weight: bold">print</span>(f<span style="color: #BA2121">&quot;Getting data for season {season}&quot;</span>)

        <span style="color: #408080; font-style: italic"># Read the data from the url into a DataFrame</span>
        temp_df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(url)
        temp_df[<span style="color: #BA2121">&#39;season&#39;</span>] <span style="color: #666666">=</span> season

        <span style="color: #408080; font-style: italic"># Create helpful columns like Day, Month, Year, Date etc. so that our data is clean</span>
        temp_df <span style="color: #666666">=</span> (temp_df<span style="color: #666666">.</span>dropna(axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>, thresh<span style="color: #666666">=</span>temp_df<span style="color: #666666">.</span>shape[<span style="color: #666666">0</span>]<span style="color: #666666">-30</span>)
                          <span style="color: #666666">.</span>assign(Day<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>Date<span style="color: #666666">.</span>str<span style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;/&#39;</span>)<span style="color: #666666">.</span>str[<span style="color: #666666">0</span>],
                                  Month<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>Date<span style="color: #666666">.</span>str<span style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;/&#39;</span>)<span style="color: #666666">.</span>str[<span style="color: #666666">1</span>],
                                  Year<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>Date<span style="color: #666666">.</span>str<span style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;/&#39;</span>)<span style="color: #666666">.</span>str[<span style="color: #666666">2</span>])
                          <span style="color: #666666">.</span>assign(Date<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>Month <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;/&#39;</span> <span style="color: #666666">+</span> df<span style="color: #666666">.</span>Day <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;/&#39;</span> <span style="color: #666666">+</span> df<span style="color: #666666">.</span>Year)
                          <span style="color: #666666">.</span>assign(Date<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: pd<span style="color: #666666">.</span>to_datetime(df<span style="color: #666666">.</span>Date))
                          <span style="color: #666666">.</span>dropna())

        <span style="color: #408080; font-style: italic"># Append the temp_df to the main df</span>
        df <span style="color: #666666">=</span> df<span style="color: #666666">.</span>append(temp_df, sort<span style="color: #666666">=</span><span style="color: #008000">True</span>)

    <span style="color: #408080; font-style: italic"># Drop all NAs</span>
    df <span style="color: #666666">=</span> df<span style="color: #666666">.</span>dropna(axis<span style="color: #666666">=1</span>)<span style="color: #666666">.</span>dropna()<span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Date&#39;</span>)
    <span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&quot;Finished grabbing data.&quot;</span>)

    <span style="color: #008000; font-weight: bold">return</span> df
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>df <span style="color: #666666">=</span> grab_epl_data()
<span style="color: #408080; font-style: italic"># df.to_csv(&quot;data/epl_data.csv&quot;, index=False)</span>

    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1819</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1718</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1617</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1516</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1415</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1314</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1213</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1112</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">1011</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">0910</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">0809</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">0708</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">0607</span>
    Getting data <span style="color: #008000; font-weight: bold">for</span> season <span style="color: #666666">0506</span>
    Finished grabbing data<span style="color: #666666">.</span>
</pre></div>

<p>Whenever we want to update our data (for example if we want the most recent Gameweek included), all we have to do is run that function and then save the data to a csv with the commented out line above.</p>
<hr />
<h2 id="data-exploration">Data Exploration<a class="headerlink" href="#data-exploration" title="Permanent link">&para;</a></h2>
<p>Now that we have our data, let's explore it. Let's first look at home team win rates since 2005 to see if there is a consistent trend. To get an idea of what our data looks like, we'll look at the tail of the dataset first.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>df<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>AC</th>
<th>AF</th>
<th>AR</th>
<th>AS</th>
<th>AST</th>
<th>AY</th>
<th>AwayTeam</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Date</th>
<th>Day</th>
<th>Div</th>
<th>FTAG</th>
<th>FTHG</th>
<th>FTR</th>
<th>HC</th>
<th>HF</th>
<th>HR</th>
<th>HS</th>
<th>HST</th>
<th>HTAG</th>
<th>HTHG</th>
<th>HTR</th>
<th>HY</th>
<th>HomeTeam</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>Referee</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>season</th>
</tr>
</thead>
<tbody>
<tr>
<td>28</td>
<td>3.0</td>
<td>11.0</td>
<td>0.0</td>
<td>9.0</td>
<td>3.0</td>
<td>2.0</td>
<td>Crystal Palace</td>
<td>3.00</td>
<td>3.25</td>
<td>2.60</td>
<td>2.95</td>
<td>3.1</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.71</td>
<td>2.13</td>
<td>2.92</td>
<td>1.73</td>
<td>2.16</td>
<td>3.22</td>
<td>2.55</td>
<td>1.79</td>
<td>2.21</td>
<td>3.04</td>
<td>1.77</td>
<td>2.23</td>
<td>3.36</td>
<td>2.66</td>
<td>39.0</td>
<td>2018-08-26</td>
<td>26</td>
<td>E0</td>
<td>1.0</td>
<td>2.0</td>
<td>H</td>
<td>6.0</td>
<td>14.0</td>
<td>0.0</td>
<td>13.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>4.0</td>
<td>Watford</td>
<td>2.95</td>
<td>3.20</td>
<td>2.5</td>
<td>2.90</td>
<td>3.1</td>
<td>2.50</td>
<td>08</td>
<td>A Taylor</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>18</td>
<td>1819</td>
</tr>
<tr>
<td>27</td>
<td>5.0</td>
<td>8.0</td>
<td>0.0</td>
<td>15.0</td>
<td>3.0</td>
<td>1.0</td>
<td>Chelsea</td>
<td>1.66</td>
<td>4.00</td>
<td>5.75</td>
<td>1.67</td>
<td>3.8</td>
<td>5.25</td>
<td>42.0</td>
<td>22.0</td>
<td>1.00</td>
<td>1.92</td>
<td>1.88</td>
<td>1.67</td>
<td>2.18</td>
<td>1.71</td>
<td>3.90</td>
<td>5.25</td>
<td>2.01</td>
<td>1.95</td>
<td>1.71</td>
<td>2.28</td>
<td>1.76</td>
<td>4.17</td>
<td>5.75</td>
<td>40.0</td>
<td>2018-08-26</td>
<td>26</td>
<td>E0</td>
<td>2.0</td>
<td>1.0</td>
<td>A</td>
<td>4.0</td>
<td>16.0</td>
<td>0.0</td>
<td>6.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>3.0</td>
<td>Newcastle</td>
<td>1.70</td>
<td>3.75</td>
<td>5.0</td>
<td>1.67</td>
<td>3.8</td>
<td>5.25</td>
<td>08</td>
<td>P Tierney</td>
<td>1.67</td>
<td>4.0</td>
<td>5.5</td>
<td>18</td>
<td>1819</td>
</tr>
<tr>
<td>29</td>
<td>2.0</td>
<td>16.0</td>
<td>0.0</td>
<td>9.0</td>
<td>5.0</td>
<td>4.0</td>
<td>Tottenham</td>
<td>2.90</td>
<td>3.30</td>
<td>2.62</td>
<td>2.90</td>
<td>3.2</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.79</td>
<td>2.03</td>
<td>2.86</td>
<td>1.72</td>
<td>2.18</td>
<td>3.27</td>
<td>2.56</td>
<td>1.84</td>
<td>2.10</td>
<td>3.00</td>
<td>1.76</td>
<td>2.25</td>
<td>3.40</td>
<td>2.67</td>
<td>40.0</td>
<td>2018-08-27</td>
<td>27</td>
<td>E0</td>
<td>3.0</td>
<td>0.0</td>
<td>A</td>
<td>5.0</td>
<td>11.0</td>
<td>0.0</td>
<td>23.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>2.0</td>
<td>Man United</td>
<td>2.75</td>
<td>3.25</td>
<td>2.6</td>
<td>2.75</td>
<td>3.2</td>
<td>2.55</td>
<td>08</td>
<td>C Pawson</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>18</td>
<td>1819</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Create Home Win, Draw Win and Away Win columns</span>
df <span style="color: #666666">=</span> df<span style="color: #666666">.</span>assign(homeWin<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> row: <span style="color: #666666">1</span> <span style="color: #008000; font-weight: bold">if</span> row<span style="color: #666666">.</span>FTHG <span style="color: #666666">&gt;</span> row<span style="color: #666666">.</span>FTAG <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">0</span>, axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>),
              draw<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> row: <span style="color: #666666">1</span> <span style="color: #008000; font-weight: bold">if</span> row<span style="color: #666666">.</span>FTHG <span style="color: #666666">==</span> row<span style="color: #666666">.</span>FTAG <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">0</span>, axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>),
              awayWin<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> row: <span style="color: #666666">1</span> <span style="color: #008000; font-weight: bold">if</span> row<span style="color: #666666">.</span>FTHG <span style="color: #666666">&lt;</span> row<span style="color: #666666">.</span>FTAG <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">0</span>, axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>))
</pre></div>

<h3 id="home-ground-advantage">Home Ground Advantage<a class="headerlink" href="#home-ground-advantage" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>win_rates <span style="color: #666666">=</span> \
(df<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;season&#39;</span>)
    <span style="color: #666666">.</span>mean()
    <span style="color: #666666">.</span>loc[:, [<span style="color: #BA2121">&#39;homeWin&#39;</span>, <span style="color: #BA2121">&#39;draw&#39;</span>, <span style="color: #BA2121">&#39;awayWin&#39;</span>]])

win_rates
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>homeWin</th>
<th>draw</th>
<th>awayWin</th>
</tr>
</thead>
<tbody>
<tr>
<td>season</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0506</td>
<td>0.505263</td>
<td>0.202632</td>
<td>0.292105</td>
</tr>
<tr>
<td>0607</td>
<td>0.477573</td>
<td>0.258575</td>
<td>0.263852</td>
</tr>
<tr>
<td>0708</td>
<td>0.463158</td>
<td>0.263158</td>
<td>0.273684</td>
</tr>
<tr>
<td>0809</td>
<td>0.453826</td>
<td>0.255937</td>
<td>0.290237</td>
</tr>
<tr>
<td>0910</td>
<td>0.507895</td>
<td>0.252632</td>
<td>0.239474</td>
</tr>
<tr>
<td>1011</td>
<td>0.471053</td>
<td>0.292105</td>
<td>0.236842</td>
</tr>
<tr>
<td>1112</td>
<td>0.450000</td>
<td>0.244737</td>
<td>0.305263</td>
</tr>
<tr>
<td>1213</td>
<td>0.433862</td>
<td>0.285714</td>
<td>0.280423</td>
</tr>
<tr>
<td>1314</td>
<td>0.472973</td>
<td>0.208108</td>
<td>0.318919</td>
</tr>
<tr>
<td>1415</td>
<td>0.453826</td>
<td>0.245383</td>
<td>0.300792</td>
</tr>
<tr>
<td>1516</td>
<td>0.414248</td>
<td>0.282322</td>
<td>0.303430</td>
</tr>
<tr>
<td>1617</td>
<td>0.492105</td>
<td>0.221053</td>
<td>0.286842</td>
</tr>
<tr>
<td>1718</td>
<td>0.455263</td>
<td>0.260526</td>
<td>0.284211</td>
</tr>
<tr>
<td>1819</td>
<td>0.466667</td>
<td>0.200000</td>
<td>0.333333</td>
</tr>
</tbody>
</table>
<h3 id="findings">Findings<a class="headerlink" href="#findings" title="Permanent link">&para;</a></h3>
<p>As we can see, winrates across home team wins, draws and away team wins are very consistent. It seems that the home team wins around 46-47% of the time, the draw happens about 25% of the time, and the away team wins about 27% of the time. Let's plot this DataFrame so that we can see the trend more easily.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Set the style</span>
plt<span style="color: #666666">.</span>style<span style="color: #666666">.</span>use(<span style="color: #BA2121">&#39;ggplot&#39;</span>)

fig <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure()
ax <span style="color: #666666">=</span> fig<span style="color: #666666">.</span>add_subplot(<span style="color: #666666">111</span>)

home_line <span style="color: #666666">=</span> ax<span style="color: #666666">.</span>plot(win_rates<span style="color: #666666">.</span>homeWin, label<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Home Win Rate&#39;</span>)
away_line <span style="color: #666666">=</span> ax<span style="color: #666666">.</span>plot(win_rates<span style="color: #666666">.</span>awayWin, label<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Away Win Rate&#39;</span>)
draw_line <span style="color: #666666">=</span> ax<span style="color: #666666">.</span>plot(win_rates<span style="color: #666666">.</span>draw, label<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Draw Win Rate&#39;</span>)
ax<span style="color: #666666">.</span>set_xlabel(<span style="color: #BA2121">&quot;season&quot;</span>)
ax<span style="color: #666666">.</span>set_ylabel(<span style="color: #BA2121">&quot;Win Rate&quot;</span>)
plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&quot;Win Rates&quot;</span>, fontsize<span style="color: #666666">=16</span>)

<span style="color: #408080; font-style: italic"># Add the legend locations</span>
home_legend <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>legend(handles<span style="color: #666666">=</span>home_line, loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;upper right&#39;</span>, bbox_to_anchor<span style="color: #666666">=</span>(<span style="color: #666666">1</span>, <span style="color: #666666">1</span>))
ax <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>gca()<span style="color: #666666">.</span>add_artist(home_legend)
away_legend <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>legend(handles<span style="color: #666666">=</span>away_line, loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;center right&#39;</span>, bbox_to_anchor<span style="color: #666666">=</span>(<span style="color: #666666">0.95</span>, <span style="color: #666666">0.4</span>))
ax <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>gca()<span style="color: #666666">.</span>add_artist(away_legend)
draw_legend <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>legend(handles<span style="color: #666666">=</span>draw_line, loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;center right&#39;</span>, bbox_to_anchor<span style="color: #666666">=</span>(<span style="color: #666666">0.95</span>, <span style="color: #666666">0.06</span>))
</pre></div>

<p><img alt="png" src="../img/output_10_0.png" /></p>
<p>As we can see, the winrates are relatively stable each season, except for in 14/15 when the home win rate drops dramatically.</p>
<p>Out of interest, let's also have a look at which team has the best home ground advantage. Let's define HGA as home win rate - away win rate. And then plot some of the big clubs' HGA against each other.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>home_win_rates <span style="color: #666666">=</span> \
(df<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;HomeTeam&#39;</span>])
    <span style="color: #666666">.</span>homeWin
    <span style="color: #666666">.</span>mean())

away_win_rates <span style="color: #666666">=</span> \
(df<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;AwayTeam&#39;</span>])
    <span style="color: #666666">.</span>awayWin
    <span style="color: #666666">.</span>mean())

hga <span style="color: #666666">=</span> (home_win_rates <span style="color: #666666">-</span> away_win_rates)<span style="color: #666666">.</span>reset_index()<span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{<span style="color: #666666">0</span>: <span style="color: #BA2121">&#39;HGA&#39;</span>})<span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;HGA&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>hga<span style="color: #666666">.</span>head(<span style="color: #666666">10</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>HomeTeam</th>
<th>HGA</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td>Fulham</td>
<td>0.315573</td>
</tr>
<tr>
<td>7</td>
<td>Brighton</td>
<td>0.304762</td>
</tr>
<tr>
<td>20</td>
<td>Man City</td>
<td>0.244980</td>
</tr>
<tr>
<td>14</td>
<td>Everton</td>
<td>0.241935</td>
</tr>
<tr>
<td>30</td>
<td>Stoke</td>
<td>0.241131</td>
</tr>
<tr>
<td>10</td>
<td>Charlton</td>
<td>0.236842</td>
</tr>
<tr>
<td>0</td>
<td>Arsenal</td>
<td>0.236140</td>
</tr>
<tr>
<td>27</td>
<td>Reading</td>
<td>0.234962</td>
</tr>
<tr>
<td>33</td>
<td>Tottenham</td>
<td>0.220207</td>
</tr>
<tr>
<td>21</td>
<td>Man United</td>
<td>0.215620</td>
</tr>
</tbody>
</table>
<p>So the club with the best HGA is Fulham - interesting. This is most likely because Fulham have won 100% of home games in 2018 so far which is skewing the mean. Let's see how the HGA for some of the big clubs based compare over seasons.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>big_clubs <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;Liverpool&#39;</span>, <span style="color: #BA2121">&#39;Man City&#39;</span>, <span style="color: #BA2121">&#39;Man United&#39;</span>, <span style="color: #BA2121">&#39;Chelsea&#39;</span>, <span style="color: #BA2121">&#39;Arsenal&#39;</span>]
home_win_rates_5 <span style="color: #666666">=</span> df[df<span style="color: #666666">.</span>HomeTeam<span style="color: #666666">.</span>isin(big_clubs)]<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;HomeTeam&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>])<span style="color: #666666">.</span>homeWin<span style="color: #666666">.</span>mean()
away_win_rates_5 <span style="color: #666666">=</span> df[df<span style="color: #666666">.</span>AwayTeam<span style="color: #666666">.</span>isin(big_clubs)]<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;AwayTeam&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>])<span style="color: #666666">.</span>awayWin<span style="color: #666666">.</span>mean()

hga_top_5 <span style="color: #666666">=</span> home_win_rates_5 <span style="color: #666666">-</span> away_win_rates_5

hga_top_5<span style="color: #666666">.</span>unstack(level<span style="color: #666666">=0</span>)
</pre></div>

<table>
<thead>
<tr>
<th>HomeTeam</th>
<th>Arsenal</th>
<th>Chelsea</th>
<th>Liverpool</th>
<th>Man City</th>
<th>Man United</th>
</tr>
</thead>
<tbody>
<tr>
<td>season</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0506</td>
<td>0.421053</td>
<td>0.368421</td>
<td>0.263158</td>
<td>0.263158</td>
<td>0.052632</td>
</tr>
<tr>
<td>0607</td>
<td>0.263158</td>
<td>0.000000</td>
<td>0.421053</td>
<td>-0.052632</td>
<td>0.105263</td>
</tr>
<tr>
<td>0708</td>
<td>0.210526</td>
<td>-0.052632</td>
<td>0.157895</td>
<td>0.368421</td>
<td>0.368421</td>
</tr>
<tr>
<td>0809</td>
<td>0.105263</td>
<td>-0.157895</td>
<td>-0.052632</td>
<td>0.578947</td>
<td>0.210526</td>
</tr>
<tr>
<td>0910</td>
<td>0.368421</td>
<td>0.368421</td>
<td>0.421053</td>
<td>0.315789</td>
<td>0.263158</td>
</tr>
<tr>
<td>1011</td>
<td>0.157895</td>
<td>0.368421</td>
<td>0.368421</td>
<td>0.263158</td>
<td>0.684211</td>
</tr>
<tr>
<td>1112</td>
<td>0.157895</td>
<td>0.315789</td>
<td>-0.105263</td>
<td>0.421053</td>
<td>0.105263</td>
</tr>
<tr>
<td>1213</td>
<td>0.052632</td>
<td>0.105263</td>
<td>0.105263</td>
<td>0.248538</td>
<td>0.201754</td>
</tr>
<tr>
<td>1314</td>
<td>0.143275</td>
<td>0.251462</td>
<td>0.307018</td>
<td>0.362573</td>
<td>-0.026316</td>
</tr>
<tr>
<td>1415</td>
<td>0.131579</td>
<td>0.210526</td>
<td>0.105263</td>
<td>0.210526</td>
<td>0.421053</td>
</tr>
<tr>
<td>1516</td>
<td>0.210526</td>
<td>-0.105263</td>
<td>0.000000</td>
<td>0.263158</td>
<td>0.263158</td>
</tr>
<tr>
<td>1617</td>
<td>0.263158</td>
<td>0.210526</td>
<td>0.105263</td>
<td>-0.052632</td>
<td>-0.105263</td>
</tr>
<tr>
<td>1718</td>
<td>0.578947</td>
<td>0.052632</td>
<td>0.157895</td>
<td>0.000000</td>
<td>0.263158</td>
</tr>
<tr>
<td>1819</td>
<td>0.500000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.500000</td>
<td>0.500000</td>
</tr>
</tbody>
</table>
<p>Now let's plot it.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>sns<span style="color: #666666">.</span>lineplot(x<span style="color: #666666">=</span><span style="color: #BA2121">&#39;season&#39;</span>, y<span style="color: #666666">=</span><span style="color: #BA2121">&#39;HGA&#39;</span>, hue<span style="color: #666666">=</span><span style="color: #BA2121">&#39;team&#39;</span>, data<span style="color: #666666">=</span>hga_top_5<span style="color: #666666">.</span>reset_index()<span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{<span style="color: #666666">0</span>: <span style="color: #BA2121">&#39;HGA&#39;</span>, <span style="color: #BA2121">&#39;HomeTeam&#39;</span>: <span style="color: #BA2121">&#39;team&#39;</span>}))
plt<span style="color: #666666">.</span>legend(loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;lower center&#39;</span>, ncol<span style="color: #666666">=6</span>, bbox_to_anchor<span style="color: #666666">=</span>(<span style="color: #666666">0.45</span>, <span style="color: #666666">-0.2</span>))
plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&quot;HGA Among the top 5 clubs&quot;</span>, fontsize<span style="color: #666666">=14</span>)
plt<span style="color: #666666">.</span>show()
</pre></div>

<p><img alt="png" src="../img/output_17_0.png" /></p>
<p>The results here seem to be quite erratic, although it seems that Arsenal consistently has a HGA above 0.</p>
<p>Let's now look at the distributions of each of our columns. The odds columns are likely to be highly skewed, so we may have to account for this later.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> df<span style="color: #666666">.</span>select_dtypes(<span style="color: #BA2121">&#39;number&#39;</span>)<span style="color: #666666">.</span>columns:
    sns<span style="color: #666666">.</span>distplot(df[col])
    plt<span style="color: #666666">.</span>title(f<span style="color: #BA2121">&quot;Distribution for {col}&quot;</span>)
    plt<span style="color: #666666">.</span>show()
</pre></div>

<p><img alt="png" src="../img/output_20_0.png" /></p>
<p><img alt="png" src="../img/output_20_1.png" /></p>
<p><img alt="png" src="../img/output_20_2.png" /></p>
<p><img alt="png" src="../img/output_20_3.png" /></p>
<p><img alt="png" src="../img/output_20_4.png" /></p>
<p><img alt="png" src="../img/output_20_5.png" /></p>
<p><img alt="png" src="../img/output_20_6.png" /></p>
<p><img alt="png" src="../img/output_20_7.png" /></p>
<p><img alt="png" src="../img/output_20_8.png" /></p>
<p><img alt="png" src="../img/output_20_9.png" /></p>
<p><img alt="png" src="../img/output_20_10.png" /></p>
<p><img alt="png" src="../img/output_20_11.png" /></p>
<p><img alt="png" src="../img/output_20_12.png" /></p>
<p><img alt="png" src="../img/output_20_13.png" /></p>
<p><img alt="png" src="../img/output_20_14.png" /></p>
<p><img alt="png" src="../img/output_20_15.png" /></p>
<p><img alt="png" src="../img/output_20_16.png" /></p>
<p><img alt="png" src="../img/output_20_17.png" /></p>
<p><img alt="png" src="../img/output_20_18.png" /></p>
<p><img alt="png" src="../img/output_20_19.png" /></p>
<p><img alt="png" src="../img/output_20_20.png" /></p>
<p><img alt="png" src="../img/output_20_21.png" /></p>
<p><img alt="png" src="../img/output_20_22.png" /></p>
<p><img alt="png" src="../img/output_20_23.png" /></p>
<p><img alt="png" src="../img/output_20_24.png" /></p>
<p><img alt="png" src="../img/output_20_25.png" /></p>
<p><img alt="png" src="../img/output_20_26.png" /></p>
<p><img alt="png" src="../img/output_20_27.png" /></p>
<p><img alt="png" src="../img/output_20_28.png" /></p>
<p><img alt="png" src="../img/output_20_29.png" /></p>
<p><img alt="png" src="../img/output_20_30.png" /></p>
<p><img alt="png" src="../img/output_20_31.png" /></p>
<p><img alt="png" src="../img/output_20_32.png" /></p>
<p><img alt="png" src="../img/output_20_33.png" /></p>
<p><img alt="png" src="../img/output_20_34.png" /></p>
<p><img alt="png" src="../img/output_20_35.png" /></p>
<p><img alt="png" src="../img/output_20_36.png" /></p>
<p><img alt="png" src="../img/output_20_37.png" /></p>
<p><img alt="png" src="../img/output_20_38.png" /></p>
<p><img alt="png" src="../img/output_20_39.png" /></p>
<p><img alt="png" src="../img/output_20_40.png" /></p>
<p><img alt="png" src="../img/output_20_41.png" /></p>
<p><img alt="png" src="../img/output_20_42.png" /></p>
<p><img alt="png" src="../img/output_20_43.png" /></p>
<p><img alt="png" src="../img/output_20_44.png" /></p>
<p><img alt="png" src="../img/output_20_45.png" /></p>
<p><img alt="png" src="../img/output_20_46.png" /></p>
<p><img alt="png" src="../img/output_20_47.png" /></p>
<p><img alt="png" src="../img/output_20_48.png" /></p>
<p><img alt="png" src="../img/output_20_49.png" /></p>
<p><img alt="png" src="../img/output_20_50.png" /></p>
<p><img alt="png" src="../img/output_20_51.png" /></p>
<p><img alt="png" src="../img/output_20_52.png" /></p>
<hr />
<h2 id="exploring-referee-home-ground-bias">Exploring Referee Home Ground Bias<a class="headerlink" href="#exploring-referee-home-ground-bias" title="Permanent link">&para;</a></h2>
<p>What may be of interest is whether certain referees are correlated with the home team winning more often. Let's explore referee home ground bias for referees for the top 10 Referees based on games.</p>
<p><div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&#39;Overall Home Win Rate: {:.4}%&#39;</span><span style="color: #666666">.</span>format(df<span style="color: #666666">.</span>homeWin<span style="color: #666666">.</span>mean() <span style="color: #666666">*</span> <span style="color: #666666">100</span>))

<span style="color: #408080; font-style: italic"># Get the top 10 refs based on games</span>
top_10_refs <span style="color: #666666">=</span> df<span style="color: #666666">.</span>Referee<span style="color: #666666">.</span>value_counts()<span style="color: #666666">.</span>head(<span style="color: #666666">10</span>)<span style="color: #666666">.</span>index

df[df<span style="color: #666666">.</span>Referee<span style="color: #666666">.</span>isin(top_10_refs)]<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;Referee&#39;</span>)<span style="color: #666666">.</span>homeWin<span style="color: #666666">.</span>mean()<span style="color: #666666">.</span>sort_values(ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)
</pre></div>
    Overall Home Win Rate: 46.55%</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Referee
L Mason          0.510373
C Foy            0.500000
M Clattenburg    0.480000
M Jones          0.475248
P Dowd           0.469880
M Atkinson       0.469565
M Oliver         0.466019
H Webb           0.456604
A Marriner       0.455516
M Dean           0.442049
Name: homeWin, dtype: float64
</pre></div>


<p>It seems that L Mason may be the most influenced by the home crowd. Whilst the overall home win rate is 46.5%, the home win rate when he is the Referee is 51%. However it should be noted that this doesn't mean that he causes the win through bias. It could just be that he referees the best clubs, so naturally their home win rate is high.</p>
<hr />
<h2 id="variable-correlation-with-margin">Variable Correlation With Margin<a class="headerlink" href="#variable-correlation-with-margin" title="Permanent link">&para;</a></h2>
<p>Let's now explore different variables' relationships with margin. First, we'll create a margin column, then we will pick a few different variables to look at the correlations amongst each other, using a correlation heatmap.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>df[<span style="color: #BA2121">&#39;margin&#39;</span>] <span style="color: #666666">=</span> df[<span style="color: #BA2121">&#39;FTHG&#39;</span>] <span style="color: #666666">-</span> df[<span style="color: #BA2121">&#39;FTAG&#39;</span>]
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>stat_cols <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;AC&#39;</span>, <span style="color: #BA2121">&#39;AF&#39;</span>, <span style="color: #BA2121">&#39;AR&#39;</span>, <span style="color: #BA2121">&#39;AS&#39;</span>, <span style="color: #BA2121">&#39;AST&#39;</span>, <span style="color: #BA2121">&#39;AY&#39;</span>, <span style="color: #BA2121">&#39;HC&#39;</span>, <span style="color: #BA2121">&#39;HF&#39;</span>, <span style="color: #BA2121">&#39;HR&#39;</span>, <span style="color: #BA2121">&#39;HS&#39;</span>, <span style="color: #BA2121">&#39;HST&#39;</span>, <span style="color: #BA2121">&#39;HTR&#39;</span>, <span style="color: #BA2121">&#39;HY&#39;</span>, <span style="color: #BA2121">&#39;margin&#39;</span>]

stat_correlations <span style="color: #666666">=</span> df[stat_cols]<span style="color: #666666">.</span>corr()
stat_correlations[<span style="color: #BA2121">&#39;margin&#39;</span>]<span style="color: #666666">.</span>sort_values()

    AST      <span style="color: #666666">-0.345703</span>
    AS       <span style="color: #666666">-0.298665</span>
    HY       <span style="color: #666666">-0.153806</span>
    HR       <span style="color: #666666">-0.129393</span>
    AC       <span style="color: #666666">-0.073204</span>
    HF       <span style="color: #666666">-0.067469</span>
    AF        <span style="color: #666666">0.005474</span>
    AY        <span style="color: #666666">0.013746</span>
    HC        <span style="color: #666666">0.067433</span>
    AR        <span style="color: #666666">0.103528</span>
    HS        <span style="color: #666666">0.275847</span>
    HST       <span style="color: #666666">0.367591</span>
    margin    <span style="color: #666666">1.000000</span>
    Name: margin, dtype: float64
</pre></div>

<p>Unsurprisingly, Home Shots on Target correlate the most with Margin, and Away Reds is also high. What is surprising is that Home Yellows has quite a strong negative correlation with margin - this may be because players will play more aggresively when they are losing to try and get the lead back, and hence receive more yellow cards.</p>
<p>Let's now look at the heatmap between variables.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>sns<span style="color: #666666">.</span>heatmap(stat_correlations, annot<span style="color: #666666">=</span><span style="color: #008000">True</span>, annot_kws<span style="color: #666666">=</span>{<span style="color: #BA2121">&#39;size&#39;</span>: <span style="color: #666666">10</span>})
    <span style="color: #666666">&lt;</span>matplotlib<span style="color: #666666">.</span>axes<span style="color: #666666">.</span>_subplots<span style="color: #666666">.</span>AxesSubplot at <span style="color: #666666">0x220a4227048&gt;</span>
</pre></div>

<p><img alt="png" src="../img/output_28_1.png" /></p>
<hr />
<h2 id="analysing-features">Analysing Features<a class="headerlink" href="#analysing-features" title="Permanent link">&para;</a></h2>
<p>What we are really interested in, is how our features (creating in the next tutorial), correlate with winning. We will skip ahead here and use a function to create our features for us, and then examine how the moving averages/different features correlate with winning.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Create a cleaned df of all of our data</span>
pre_features_df <span style="color: #666666">=</span> create_df(<span style="color: #BA2121">&#39;data/epl_data.csv&#39;</span>)

<span style="color: #408080; font-style: italic"># Create our features</span>
features <span style="color: #666666">=</span> create_feature_df(pre_features_df)
    Creating <span style="color: #008000">all</span> games feature DataFrame

    C:\Users\wardj\Documents\Betfair Public Github\predictive<span style="color: #666666">-</span>models\epl\data_preparation_functions<span style="color: #666666">.</span>py:<span style="color: #666666">419</span>: <span style="color: #D2413A; font-weight: bold">RuntimeWarning</span>: invalid value encountered <span style="color: #AA22FF; font-weight: bold">in</span> double_scalars
      <span style="color: #666666">.</span>pipe(<span style="color: #008000; font-weight: bold">lambda</span> df: (df<span style="color: #666666">.</span>eloAgainst <span style="color: #666666">*</span> df[goalsForOrAgainstCol])<span style="color: #666666">.</span>sum() <span style="color: #666666">/</span> df<span style="color: #666666">.</span>eloAgainst<span style="color: #666666">.</span>sum()))

    Creating stats feature DataFrame
    Creating odds feature DataFrame
    Creating market values feature DataFrame
    Filling NAs
    Merging stats, odds <span style="color: #AA22FF; font-weight: bold">and</span> market values into one features DataFrame
    Complete<span style="color: #666666">.</span>
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features <span style="color: #666666">=</span> (pre_features_df<span style="color: #666666">.</span>assign(margin<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>FTHG <span style="color: #666666">-</span> df<span style="color: #666666">.</span>FTAG)
                           <span style="color: #666666">.</span>loc[:, [<span style="color: #BA2121">&#39;gameId&#39;</span>, <span style="color: #BA2121">&#39;margin&#39;</span>]]
                           <span style="color: #666666">.</span>pipe(pd<span style="color: #666666">.</span>merge, features, on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;gameId&#39;</span>]))
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features<span style="color: #666666">.</span>corr()<span style="color: #666666">.</span>margin<span style="color: #666666">.</span>sort_values(ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)[:<span style="color: #666666">20</span>]

    margin                     <span style="color: #666666">1.000000</span>
    f_awayOdds                 <span style="color: #666666">0.413893</span>
    f_totalMktH<span style="color: #666666">%</span>               <span style="color: #666666">0.330420</span>
    f_defMktH<span style="color: #666666">%</span>                 <span style="color: #666666">0.325392</span>
    f_eloAgainstAway           <span style="color: #666666">0.317853</span>
    f_eloForHome               <span style="color: #666666">0.317853</span>
    f_midMktH<span style="color: #666666">%</span>                 <span style="color: #666666">0.316080</span>
    f_attMktH<span style="color: #666666">%</span>                 <span style="color: #666666">0.312262</span>
    f_sizeOfHandicapAway       <span style="color: #666666">0.301667</span>
    f_goalsForHome             <span style="color: #666666">0.298930</span>
    f_wtEloGoalsForHome        <span style="color: #666666">0.297157</span>
    f_shotsForHome             <span style="color: #666666">0.286239</span>
    f_cornersForHome           <span style="color: #666666">0.279917</span>
    f_gkMktH<span style="color: #666666">%</span>                  <span style="color: #666666">0.274732</span>
    f_homeWinPc38Away          <span style="color: #666666">0.271326</span>
    f_homeWinPc38Home          <span style="color: #666666">0.271326</span>
    f_wtEloGoalsAgainstAway    <span style="color: #666666">0.269663</span>
    f_goalsAgainstAway         <span style="color: #666666">0.258418</span>
    f_cornersAgainstAway       <span style="color: #666666">0.257148</span>
    f_drawOdds                 <span style="color: #666666">0.256807</span>
    Name: margin, dtype: float64
</pre></div>

<p>As we can see away odds is most highly correlated to margin. This makes sense, as odds generally have most/all information included in the price. What is interesting is that elo seems to also be highly correlated, which is good news for our elo model that we made. Similarly, weighted goals and the the value of the defence relative to other teams ('defMktH%' etc.) is strongly correlated to margin.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Aus Open Python Tutorial
              </span>
            </div>
          </a>
        
        
          <a href="../EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                EPL 02. Data preparation & feature engineering
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/Betfair_Aus" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/company/betfair-australia" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://facebook.com/betfairaustralia" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://youtube.com/user/betfairaus" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://github.com/betfair-datascientists" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
    <div class="bf-footer">
      <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
      <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its Responsible Gambling Code of Conduct and for South
      Australian residents by the South Australian Responsible Gambling Code of Practice.<br> Think! About your choices. Think of the people who need your support. Gamble responsibly. Call Gambling Help 1800 858 858 <a href="https://gamblinghelponline.org.au">www.gamblinghelponline.org.au</a></p>
      <ul class="bf-links">
        <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
        <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
        <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
        <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
        <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
      </ul>
    </div>
  </div>
  <script src="https://js.adsrvr.org/up_loader.1.1.0.js"></script>
  <script>ttd_dom_ready(function(){"function"==typeof TTDUniversalPixelApi&&(new TTDUniversalPixelApi).init("y12d1ir",["8ml4f17"],"https://insight.adsrvr.org/track/up")})</script>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.72d6715c.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125973915-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>