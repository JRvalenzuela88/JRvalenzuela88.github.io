



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/AFLmodelPart1/">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>AFL 01. Data cleaning - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.834e7605.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.dd00d4b7.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    <link rel="stylesheet" href="../../assets/fonts/clarke-regular.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#afl-modelling-walkthrough" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-header-nav__button md-logo">
          
            <img src="../../img/logo.svg" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                The Automation Hub
              </span>
              <span class="md-header-nav__topic">
                AFL 01. Data cleaning
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      <div class="bf-nav md-flex__cell">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26"/>
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z"/>
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Home" class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../thirdPartyTools/overview/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../api/apiappkey/" title="API" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../historicData/dataSources/" title="Historic Data" class="md-tabs__link">
          Historic Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../howToModel/" title="Modelling" class="md-tabs__link md-tabs__link--active">
          Modelling
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-nav__button md-logo">
      
        <img src="../../img/logo.svg" width="48" height="48">
      
    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="The Automation Hub" class="md-nav__link">
      The Automation Hub
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/overview/" title="Tools Overview" class="md-nav__link">
      Tools Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Bet Angel Professional
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Bet Angel Professional
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngel/betAngel/" title="Overview - Bet Angel Pro" class="md-nav__link">
      Overview - Bet Angel Pro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelbeginners/" title="Bet Angel - A beginner's guide" class="md-nav__link">
      Bet Angel - A beginner's guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelintermediate/" title="Bet Angel - An intermediate guide" class="md-nav__link">
      Bet Angel - An intermediate guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngeladvanced/" title="Bet Angel - An advanced guide" class="md-nav__link">
      Bet Angel - An advanced guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelTippingAutomation/" title="Tipping automation" class="md-nav__link">
      Tipping automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Gruss Betting Assistant
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Gruss Betting Assistant
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/Gruss/Gruss/" title="Overview - Gruss" class="md-nav__link">
      Overview - Gruss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussMarketFavouriteAutomation/" title="Market favourite automation" class="md-nav__link">
      Market favourite automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grusslSimultaneousMarkets/" title="Simultaneous markets" class="md-nav__link">
      Simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussKellyStake/" title="Kelly Criterion staking" class="md-nav__link">
      Kelly Criterion staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Cymatic Trader
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Cymatic Trader
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/CymaticTrader/CymaticTrader/" title="Overview - Cymatic Trader" class="md-nav__link">
      Overview - Cymatic Trader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/cymaticTraderRatingsAutomation/" title="Ratings automation" class="md-nav__link">
      Ratings automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiappkey/" title="How to access the Betfair API" class="md-nav__link">
      How to access the Betfair API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiRtutorial/" title="API tutorials in R" class="md-nav__link">
      API tutorials in R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiPythontutorial/" title="API tutorial in Python" class="md-nav__link">
      API tutorial in Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Historic Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Historic Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/dataSources/" title="Historic Data Sources" class="md-nav__link">
      Historic Data Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/usingHistoricDataSite/" title="Downloading from the Historic Data site" class="md-nav__link">
      Downloading from the Historic Data site
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Modelling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModel/" title="Intro to modelling" class="md-nav__link">
      Intro to modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModelTheAusOpen/" title="How to model the Australian Open" class="md-nav__link">
      How to model the Australian Open
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenRTutorial/" title="Aus Open R Tutorial" class="md-nav__link">
      Aus Open R Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-nav__link">
      Aus Open Python Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart1/" title="EPL 01. Data acquisition & exploration" class="md-nav__link">
      EPL 01. Data acquisition & exploration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-nav__link">
      EPL 02. Data preparation & feature engineering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart3/" title="EPL 03. Model building & hyperparameter tuning" class="md-nav__link">
      EPL 03. Model building & hyperparameter tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart4/" title="EPL 04. Weekly predictions" class="md-nav__link">
      EPL 04. Weekly predictions
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="AFL 01. Data cleaning" class="md-nav__link md-nav__link--active">
      AFL 01. Data cleaning
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart2/" title="AFL 02. Feature creation" class="md-nav__link">
      AFL 02. Feature creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart3/" title="AFL 03. Modelling" class="md-nav__link">
      AFL 03. Modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart4/" title="AFL 04. Weekly predictions" class="md-nav__link">
      AFL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../brownlowModelTutorial/" title="Modelling the Brownlow Medal" class="md-nav__link">
      Modelling the Brownlow Medal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="afl-modelling-walkthrough">AFL Modelling Walkthrough<a class="headerlink" href="#afl-modelling-walkthrough" title="Permanent link">&para;</a></h1>
<h1 id="01-data-cleaning">01. Data Cleaning<a class="headerlink" href="#01-data-cleaning" title="Permanent link">&para;</a></h1>
<p>These tutorials will walk you through how to construct your own basic AFL model, using publicly available data. The output will be odds for each team to win, which will be shown on <a href="https://www.betfair.com.au/hub/tools/models/afl-prediction-model/">The Hub</a>.</p>
<p>In this notebook we will walk you through the basics of cleaning this dataset and how we have done it. If you want to get straight to feature creation or modelling, feel free to jump ahead!</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Import libraries</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">pandas</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">pd</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">re</span>
pd<span style="color: #666666">.</span>set_option(<span style="color: #BA2121">&#39;display.max_columns&#39;</span>, <span style="color: #008000">None</span>)
</pre></div>

<p>We will first explore the DataFrames, and then create functions to wrangle them and clean them into more consistent sets of data.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Read/clean each DataFrame</span>
match_results <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&quot;data/afl_match_results.csv&quot;</span>)
odds <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&quot;data/afl_odds.csv&quot;</span>)
player_stats <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&quot;data/afl_player_stats.csv&quot;</span>)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>odds<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>trunc</th>
<th>event_name</th>
<th>path</th>
<th>selection_name</th>
<th>odds</th>
</tr>
</thead>
<tbody>
<tr>
<td>4179</td>
<td>2018-09-01</td>
<td>Match Odds</td>
<td>VFL/Richmond Reserves v Williamstown</td>
<td>Williamstown</td>
<td>2.3878</td>
</tr>
<tr>
<td>4180</td>
<td>2018-09-01</td>
<td>Match Odds</td>
<td>WAFL/South Fremantle v West Perth</td>
<td>South Fremantle</td>
<td>1.5024</td>
</tr>
<tr>
<td>4181</td>
<td>2018-09-01</td>
<td>Match Odds</td>
<td>WAFL/South Fremantle v West Perth</td>
<td>West Perth</td>
<td>2.7382</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>match_results<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>Game</th>
<th>Date</th>
<th>Round</th>
<th>Home.Team</th>
<th>Home.Goals</th>
<th>Home.Behinds</th>
<th>Home.Points</th>
<th>Away.Team</th>
<th>Away.Goals</th>
<th>Away.Behinds</th>
<th>Away.Points</th>
<th>Venue</th>
<th>Margin</th>
<th>Season</th>
<th>Round.Type</th>
<th>Round.Number</th>
</tr>
</thead>
<tbody>
<tr>
<td>15395</td>
<td>15396</td>
<td>2018-08-26</td>
<td>R23</td>
<td>Brisbane Lions</td>
<td>11</td>
<td>6</td>
<td>72</td>
<td>West Coast</td>
<td>14</td>
<td>14</td>
<td>98</td>
<td>Gabba</td>
<td>-26</td>
<td>2018</td>
<td>Regular</td>
<td>23</td>
</tr>
<tr>
<td>15396</td>
<td>15397</td>
<td>2018-08-26</td>
<td>R23</td>
<td>Melbourne</td>
<td>15</td>
<td>12</td>
<td>102</td>
<td>GWS</td>
<td>8</td>
<td>9</td>
<td>57</td>
<td>M.C.G.</td>
<td>45</td>
<td>2018</td>
<td>Regular</td>
<td>23</td>
</tr>
<tr>
<td>15397</td>
<td>15398</td>
<td>2018-08-26</td>
<td>R23</td>
<td>St Kilda</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>North Melbourne</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>Docklands</td>
<td>-23</td>
<td>2018</td>
<td>Regular</td>
<td>23</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>player_stats<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">AF</th>
<th align="center">B</th>
<th align="center">BO</th>
<th align="center">CCL</th>
<th align="center">CG</th>
<th align="center">CL</th>
<th align="center">CM</th>
<th align="center">CP</th>
<th align="center">D</th>
<th align="center">DE</th>
<th align="center">Date</th>
<th align="center">ED</th>
<th align="center">FA</th>
<th align="center">FF</th>
<th align="center">G</th>
<th align="center">GA</th>
<th align="center">HB</th>
<th align="center">HO</th>
<th align="center">I50</th>
<th align="center">ITC</th>
<th align="center">K</th>
<th align="center">M</th>
<th align="center">MG</th>
<th align="center">MI5</th>
<th align="center">Match_id</th>
<th align="center">One.Percenters</th>
<th align="center">Opposition</th>
<th align="center">Player</th>
<th align="center">R50</th>
<th align="center">Round</th>
<th align="center">SC</th>
<th align="center">SCL</th>
<th align="center">SI</th>
<th align="center">Season</th>
<th align="center">Status</th>
<th align="center">T</th>
<th align="center">T5</th>
<th align="center">TO</th>
<th align="center">TOG</th>
<th align="center">Team</th>
<th align="center">UP</th>
<th align="center">Venue</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">89317</td>
<td align="center">38</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0.0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">9</td>
<td align="center">55.6</td>
<td align="center">25/08/2018</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2.0</td>
<td align="center">6</td>
<td align="center">3</td>
<td align="center">132.0</td>
<td align="center">2</td>
<td align="center">9711</td>
<td align="center">0</td>
<td align="center">Fremantle</td>
<td align="center">Christopher Mayne</td>
<td align="center">1</td>
<td align="center">Round 23</td>
<td align="center">35</td>
<td align="center">0.0</td>
<td align="center">2.0</td>
<td align="center">2018</td>
<td align="center">Away</td>
<td align="center">1</td>
<td align="center">0.0</td>
<td align="center">1.0</td>
<td align="center">57</td>
<td align="center">Collingwood</td>
<td align="center">7</td>
<td align="center">Optus Stadium</td>
</tr>
<tr>
<td align="center">89318</td>
<td align="center">38</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0.0</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">9</td>
<td align="center">55.6</td>
<td align="center">25/08/2018</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">4.0</td>
<td align="center">6</td>
<td align="center">3</td>
<td align="center">172.0</td>
<td align="center">0</td>
<td align="center">9711</td>
<td align="center">2</td>
<td align="center">Fremantle</td>
<td align="center">Nathan Murphy</td>
<td align="center">5</td>
<td align="center">Round 23</td>
<td align="center">29</td>
<td align="center">0.0</td>
<td align="center">0.0</td>
<td align="center">2018</td>
<td align="center">Away</td>
<td align="center">1</td>
<td align="center">0.0</td>
<td align="center">3.0</td>
<td align="center">70</td>
<td align="center">Collingwood</td>
<td align="center">6</td>
<td align="center">Optus Stadium</td>
</tr>
<tr>
<td align="center">89319</td>
<td align="center">56</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0.0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">3</td>
<td align="center">8</td>
<td align="center">62.5</td>
<td align="center">25/08/2018</td>
<td align="center">5</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2.0</td>
<td align="center">6</td>
<td align="center">3</td>
<td align="center">180.0</td>
<td align="center">3</td>
<td align="center">9711</td>
<td align="center">2</td>
<td align="center">Fremantle</td>
<td align="center">Jaidyn Stephenson</td>
<td align="center">0</td>
<td align="center">Round 23</td>
<td align="center">56</td>
<td align="center">0.0</td>
<td align="center">4.0</td>
<td align="center">2018</td>
<td align="center">Away</td>
<td align="center">3</td>
<td align="center">1.0</td>
<td align="center">2.0</td>
<td align="center">87</td>
<td align="center">Collingwood</td>
<td align="center">5</td>
<td align="center">Optus Stadium</td>
</tr>
</tbody>
</table>
<p>Have a look at the structure of the DataFrames. Notice that for the odds DataFrame, each game is split between two rows, whilst for the match_results each game is on one row. We will have to get around this by splitting the games up onto two rows, as this will allow our feature transformation functions to be applied more easily later on. For the player_stats DataFrame we will aggregate these stats into each game on separate rows.</p>
<p>First, we will write functions to make the odds data look a bit nicer, with only a team column, a date column and a 'home_game' column which takes the values 0 or 1 depending on if it was a home game for that team. To do this we will use the <a href="https://docs.python.org/3/howto/regex.html">regex</a> module to extract the team names from the path column, as well as the to_datetime function from pandas. We will also replace all the inconsistent team names with consistent team names.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_cleaned_odds</span>(df<span style="color: #666666">=</span><span style="color: #008000">None</span>):
    <span style="color: #408080; font-style: italic"># If a df hasn&#39;t been specified as a parameter, read the odds df</span>
    <span style="color: #008000; font-weight: bold">if</span> df <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000">None</span>:
        df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&quot;data/afl_odds.csv&quot;</span>)

    <span style="color: #408080; font-style: italic"># Get a dictionary of team names we want to change and their new values</span>
    team_name_mapping <span style="color: #666666">=</span> {
    <span style="color: #BA2121">&#39;Adelaide Crows&#39;</span>: <span style="color: #BA2121">&#39;Adelaide&#39;</span>,
    <span style="color: #BA2121">&#39;Brisbane Lions&#39;</span>: <span style="color: #BA2121">&#39;Brisbane&#39;</span>,
    <span style="color: #BA2121">&#39;Carlton Blues&#39;</span>: <span style="color: #BA2121">&#39;Carlton&#39;</span>,
    <span style="color: #BA2121">&#39;Collingwood Magpies&#39;</span>: <span style="color: #BA2121">&#39;Collingwood&#39;</span>,
    <span style="color: #BA2121">&#39;Essendon Bombers&#39;</span>: <span style="color: #BA2121">&#39;Essendon&#39;</span>,
    <span style="color: #BA2121">&#39;Fremantle Dockers&#39;</span>: <span style="color: #BA2121">&#39;Fremantle&#39;</span>,
    <span style="color: #BA2121">&#39;GWS Giants&#39;</span>: <span style="color: #BA2121">&#39;GWS&#39;</span>,
    <span style="color: #BA2121">&#39;Geelong Cats&#39;</span>: <span style="color: #BA2121">&#39;Geelong&#39;</span>,
    <span style="color: #BA2121">&#39;Gold Coast Suns&#39;</span>: <span style="color: #BA2121">&#39;Gold Coast&#39;</span>,
    <span style="color: #BA2121">&#39;Greater Western Sydney&#39;</span>: <span style="color: #BA2121">&#39;GWS&#39;</span>,
    <span style="color: #BA2121">&#39;Greater Western Sydney Giants&#39;</span>: <span style="color: #BA2121">&#39;GWS&#39;</span>,
    <span style="color: #BA2121">&#39;Hawthorn Hawks&#39;</span>: <span style="color: #BA2121">&#39;Hawthorn&#39;</span>,
    <span style="color: #BA2121">&#39;Melbourne Demons&#39;</span>: <span style="color: #BA2121">&#39;Melbourne&#39;</span>, 
    <span style="color: #BA2121">&#39;North Melbourne Kangaroos&#39;</span>: <span style="color: #BA2121">&#39;North Melbourne&#39;</span>,
    <span style="color: #BA2121">&#39;Port Adelaide Magpies&#39;</span>: <span style="color: #BA2121">&#39;Port Adelaide&#39;</span>,
    <span style="color: #BA2121">&#39;Port Adelaide Power&#39;</span>: <span style="color: #BA2121">&#39;Port Adelaide&#39;</span>, 
    <span style="color: #BA2121">&#39;P Adelaide&#39;</span>: <span style="color: #BA2121">&#39;Port Adelaide&#39;</span>,
    <span style="color: #BA2121">&#39;Richmond Tigers&#39;</span>: <span style="color: #BA2121">&#39;Richmond&#39;</span>,
    <span style="color: #BA2121">&#39;St Kilda Saints&#39;</span>: <span style="color: #BA2121">&#39;St Kilda&#39;</span>, 
    <span style="color: #BA2121">&#39;Sydney Swans&#39;</span>: <span style="color: #BA2121">&#39;Sydney&#39;</span>,
    <span style="color: #BA2121">&#39;West Coast Eagles&#39;</span>: <span style="color: #BA2121">&#39;West Coast&#39;</span>,
    <span style="color: #BA2121">&#39;Wetsern Bulldogs&#39;</span>: <span style="color: #BA2121">&#39;Western Bulldogs&#39;</span>,
    <span style="color: #BA2121">&#39;Western Bullbogs&#39;</span>: <span style="color: #BA2121">&#39;Western Bulldogs&#39;</span>
    }

    <span style="color: #408080; font-style: italic"># Add columns</span>
    df <span style="color: #666666">=</span> (df<span style="color: #666666">.</span>assign(date<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: pd<span style="color: #666666">.</span>to_datetime(df<span style="color: #666666">.</span>trunc), <span style="color: #408080; font-style: italic"># Create a datetime column</span>
                    home_team<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>path<span style="color: #666666">.</span>str<span style="color: #666666">.</span>extract(<span style="color: #BA2121">&#39;(([\w\s]+) v ([\w\s]+))&#39;</span>, expand<span style="color: #666666">=</span><span style="color: #008000">True</span>)[<span style="color: #666666">1</span>]<span style="color: #666666">.</span>str<span style="color: #666666">.</span>strip(),
                    away_team<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>path<span style="color: #666666">.</span>str<span style="color: #666666">.</span>extract(<span style="color: #BA2121">&#39;(([\w\s]+) v ([\w\s]+))&#39;</span>, expand<span style="color: #666666">=</span><span style="color: #008000">True</span>)[<span style="color: #666666">2</span>]<span style="color: #666666">.</span>str<span style="color: #666666">.</span>strip())
            <span style="color: #666666">.</span>drop(columns<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;path&#39;</span>, <span style="color: #BA2121">&#39;trunc&#39;</span>, <span style="color: #BA2121">&#39;event_name&#39;</span>]) <span style="color: #408080; font-style: italic"># Drop irrelevant columns</span>
            <span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{<span style="color: #BA2121">&#39;selection_name&#39;</span>: <span style="color: #BA2121">&#39;team&#39;</span>}) <span style="color: #408080; font-style: italic"># Rename columns</span>
            <span style="color: #666666">.</span>replace(team_name_mapping)
            <span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;date&#39;</span>)
            <span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>)
            <span style="color: #666666">.</span>assign(home_game<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> row: <span style="color: #666666">1</span> <span style="color: #008000; font-weight: bold">if</span> row<span style="color: #666666">.</span>home_team <span style="color: #666666">==</span> row<span style="color: #666666">.</span>team <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">0</span>, axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>))
            <span style="color: #666666">.</span>drop(columns<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;home_team&#39;</span>, <span style="color: #BA2121">&#39;away_team&#39;</span>]))
    <span style="color: #008000; font-weight: bold">return</span> df
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Apply the wrangling and cleaning function</span>
odds <span style="color: #666666">=</span> get_cleaned_odds(odds)
odds<span style="color: #666666">.</span>tail()
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>team</th>
<th>odds</th>
<th>date</th>
<th>home_game</th>
</tr>
</thead>
<tbody>
<tr>
<td>4177</td>
<td>South Fremantle</td>
<td>1.5024</td>
<td>2018-09-01</td>
<td>1</td>
</tr>
<tr>
<td>4178</td>
<td>Port Melbourne</td>
<td>2.8000</td>
<td>2018-09-01</td>
<td>0</td>
</tr>
<tr>
<td>4179</td>
<td>Box Hill Hawks</td>
<td>1.4300</td>
<td>2018-09-01</td>
<td>1</td>
</tr>
<tr>
<td>4180</td>
<td>Casey Demons</td>
<td>1.9000</td>
<td>2018-09-01</td>
<td>1</td>
</tr>
<tr>
<td>4181</td>
<td>West Perth</td>
<td>2.7382</td>
<td>2018-09-01</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>We now have a DataFrame that looks nice and easy to join with our other DataFrames. Now let's lean up the match_details DataFrame.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Define a function which cleans the match results df, and separates each teams&#39; stats onto individual rows</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_cleaned_match_results</span>(df<span style="color: #666666">=</span><span style="color: #008000">None</span>):
    <span style="color: #408080; font-style: italic"># If a df hasn&#39;t been specified as a parameter, read the match_results df</span>
    <span style="color: #008000; font-weight: bold">if</span> df <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000">None</span>:
        df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&quot;data/afl_match_results.csv&quot;</span>)

    <span style="color: #408080; font-style: italic"># Create column lists to loop through - these are the columns we want in home and away dfs</span>
    home_columns <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;Game&#39;</span>, <span style="color: #BA2121">&#39;Date&#39;</span>, <span style="color: #BA2121">&#39;Round.Number&#39;</span>, <span style="color: #BA2121">&#39;Home.Team&#39;</span>, <span style="color: #BA2121">&#39;Home.Goals&#39;</span>, <span style="color: #BA2121">&#39;Home.Behinds&#39;</span>, <span style="color: #BA2121">&#39;Home.Points&#39;</span>, <span style="color: #BA2121">&#39;Margin&#39;</span>, <span style="color: #BA2121">&#39;Venue&#39;</span>, <span style="color: #BA2121">&#39;Away.Team&#39;</span>, <span style="color: #BA2121">&#39;Away.Goals&#39;</span>, <span style="color: #BA2121">&#39;Away.Behinds&#39;</span>, <span style="color: #BA2121">&#39;Away.Points&#39;</span>]
    away_columns <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;Game&#39;</span>, <span style="color: #BA2121">&#39;Date&#39;</span>, <span style="color: #BA2121">&#39;Round.Number&#39;</span>, <span style="color: #BA2121">&#39;Away.Team&#39;</span>, <span style="color: #BA2121">&#39;Away.Goals&#39;</span>, <span style="color: #BA2121">&#39;Away.Behinds&#39;</span>, <span style="color: #BA2121">&#39;Away.Points&#39;</span>, <span style="color: #BA2121">&#39;Margin&#39;</span>, <span style="color: #BA2121">&#39;Venue&#39;</span>, <span style="color: #BA2121">&#39;Home.Team&#39;</span>, <span style="color: #BA2121">&#39;Home.Goals&#39;</span>, <span style="color: #BA2121">&#39;Home.Behinds&#39;</span>, <span style="color: #BA2121">&#39;Home.Points&#39;</span>]

    mapping <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;game&#39;</span>, <span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;round&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;goals&#39;</span>, <span style="color: #BA2121">&#39;behinds&#39;</span>, <span style="color: #BA2121">&#39;points&#39;</span>, <span style="color: #BA2121">&#39;margin&#39;</span>, <span style="color: #BA2121">&#39;venue&#39;</span>, <span style="color: #BA2121">&#39;opponent&#39;</span>, <span style="color: #BA2121">&#39;opponent_goals&#39;</span>, <span style="color: #BA2121">&#39;opponent_behinds&#39;</span>, <span style="color: #BA2121">&#39;opponent_points&#39;</span>]

    team_name_mapping <span style="color: #666666">=</span> {
    <span style="color: #BA2121">&#39;Brisbane Lions&#39;</span>: <span style="color: #BA2121">&#39;Brisbane&#39;</span>,
    <span style="color: #BA2121">&#39;Footscray&#39;</span>: <span style="color: #BA2121">&#39;Western Bulldogs&#39;</span>
    }

    <span style="color: #408080; font-style: italic"># Create a df with only home games</span>
    df_home <span style="color: #666666">=</span> (df[home_columns]
                <span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{old_col: new_col <span style="color: #008000; font-weight: bold">for</span> old_col, new_col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">zip</span>(home_columns, mapping)})
                <span style="color: #666666">.</span>assign(home_game<span style="color: #666666">=1</span>))

    <span style="color: #408080; font-style: italic"># Create a df with only away games</span>
    df_away <span style="color: #666666">=</span> (df[away_columns]
                <span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{old_col: new_col <span style="color: #008000; font-weight: bold">for</span> old_col, new_col <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">zip</span>(away_columns, mapping)})
                <span style="color: #666666">.</span>assign(home_game<span style="color: #666666">=0</span>,
                        margin<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>margin <span style="color: #666666">*</span> <span style="color: #666666">-1</span>))

    <span style="color: #408080; font-style: italic"># Append these dfs together</span>
    new_df <span style="color: #666666">=</span> (df_home<span style="color: #666666">.</span>append(df_away)
                     <span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;game&#39;</span>) <span style="color: #408080; font-style: italic"># Sort by game ID</span>
                     <span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>) <span style="color: #408080; font-style: italic"># Reset index</span>
                     <span style="color: #666666">.</span>assign(date<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: pd<span style="color: #666666">.</span>to_datetime(df<span style="color: #666666">.</span>date)) <span style="color: #408080; font-style: italic"># Create a datetime column</span>
                     <span style="color: #666666">.</span>replace(team_name_mapping)) <span style="color: #408080; font-style: italic"># Rename team names to be consistent with other dfs</span>
    <span style="color: #008000; font-weight: bold">return</span> new_df
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>match_results <span style="color: #666666">=</span> get_cleaned_match_results(match_results)
match_results<span style="color: #666666">.</span>head()
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>game</th>
<th>date</th>
<th>round</th>
<th>team</th>
<th>goals</th>
<th>behinds</th>
<th>points</th>
<th>margin</th>
<th>venue</th>
<th>opponent</th>
<th>opponent_goals</th>
<th>opponent_behinds</th>
<th>opponent_points</th>
<th>home_game</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>1897-05-08</td>
<td>1</td>
<td>Fitzroy</td>
<td>6</td>
<td>13</td>
<td>49</td>
<td>33</td>
<td>Brunswick St</td>
<td>Carlton</td>
<td>2</td>
<td>4</td>
<td>16</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1897-05-08</td>
<td>1</td>
<td>Carlton</td>
<td>2</td>
<td>4</td>
<td>16</td>
<td>-33</td>
<td>Brunswick St</td>
<td>Fitzroy</td>
<td>6</td>
<td>13</td>
<td>49</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>1897-05-08</td>
<td>1</td>
<td>Collingwood</td>
<td>5</td>
<td>11</td>
<td>41</td>
<td>25</td>
<td>Victoria Park</td>
<td>St Kilda</td>
<td>2</td>
<td>4</td>
<td>16</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>1897-05-08</td>
<td>1</td>
<td>St Kilda</td>
<td>2</td>
<td>4</td>
<td>16</td>
<td>-25</td>
<td>Victoria Park</td>
<td>Collingwood</td>
<td>5</td>
<td>11</td>
<td>41</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>1897-05-08</td>
<td>1</td>
<td>Geelong</td>
<td>3</td>
<td>6</td>
<td>24</td>
<td>-23</td>
<td>Corio Oval</td>
<td>Essendon</td>
<td>7</td>
<td>5</td>
<td>47</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Now we have both the odds DataFrame and match_results DataFrame ready for feature creation! Finally, we will aggregate the player_stats DataFrame stats for each game rather than individual player stats. For this DataFrame we have regular stats, such as disposals, marks etc. and Advanced Stats, such as Tackles Inside 50 and Metres Gained. However these advanced stats are only available from 2015, so we will not be using them in this tutorial - as there isn't enough data from 2015 to train our models.</p>
<p>Let's now aggregate the player_stats DataFrame.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_cleaned_aggregate_player_stats</span>(df<span style="color: #666666">=</span><span style="color: #008000">None</span>):
    <span style="color: #408080; font-style: italic"># If a df hasn&#39;t been specified as a parameter, read the player_stats df</span>
    <span style="color: #008000; font-weight: bold">if</span> df <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000">None</span>:
        df <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&quot;data/afl_player_stats.csv&quot;</span>)

    agg_stats <span style="color: #666666">=</span> (df<span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{ <span style="color: #408080; font-style: italic"># Rename columns to lowercase</span>
                    <span style="color: #BA2121">&#39;Season&#39;</span>: <span style="color: #BA2121">&#39;season&#39;</span>,
                    <span style="color: #BA2121">&#39;Round&#39;</span>: <span style="color: #BA2121">&#39;round&#39;</span>,
                    <span style="color: #BA2121">&#39;Team&#39;</span>: <span style="color: #BA2121">&#39;team&#39;</span>,
                    <span style="color: #BA2121">&#39;Opposition&#39;</span>: <span style="color: #BA2121">&#39;opponent&#39;</span>,
                    <span style="color: #BA2121">&#39;Date&#39;</span>: <span style="color: #BA2121">&#39;date&#39;</span>
                    })
                   <span style="color: #666666">.</span>groupby(by<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;opponent&#39;</span>], as_index<span style="color: #666666">=</span><span style="color: #008000">False</span>) <span style="color: #408080; font-style: italic"># Groupby to aggregate the stats for each game</span>
                   <span style="color: #666666">.</span>sum()
                   <span style="color: #666666">.</span>drop(columns<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;DE&#39;</span>, <span style="color: #BA2121">&#39;TOG&#39;</span>, <span style="color: #BA2121">&#39;Match_id&#39;</span>]) <span style="color: #408080; font-style: italic"># Drop columns</span>
                   <span style="color: #666666">.</span>assign(date<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: pd<span style="color: #666666">.</span>to_datetime(df<span style="color: #666666">.</span>date, format<span style="color: #666666">=</span><span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">/%m/%Y&quot;</span>)) <span style="color: #408080; font-style: italic"># Create a datetime object</span>
                   <span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;date&#39;</span>)
                   <span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>))
    <span style="color: #008000; font-weight: bold">return</span> agg_stats
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>agg_stats <span style="color: #666666">=</span> get_cleaned_aggregate_player_stats(player_stats)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>agg_stats<span style="color: #666666">.</span>tail()
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>season</th>
<th>team</th>
<th>opponent</th>
<th>AF</th>
<th>B</th>
<th>BO</th>
<th>CCL</th>
<th>CG</th>
<th>CL</th>
<th>CM</th>
<th>CP</th>
<th>D</th>
<th>ED</th>
<th>FA</th>
<th>FF</th>
<th>G</th>
<th>GA</th>
<th>HB</th>
<th>HO</th>
<th>I50</th>
<th>ITC</th>
<th>K</th>
<th>M</th>
<th>MG</th>
<th>MI5</th>
<th>One.Percenters</th>
<th>R50</th>
<th>SC</th>
<th>SCL</th>
<th>SI</th>
<th>T</th>
<th>T5</th>
<th>TO</th>
<th>UP</th>
</tr>
</thead>
<tbody>
<tr>
<td>3621</td>
<td>2018-08-26</td>
<td>2018</td>
<td>Brisbane</td>
<td>West Coast</td>
<td>1652</td>
<td>5</td>
<td>0</td>
<td>14.0</td>
<td>49</td>
<td>37</td>
<td>8</td>
<td>132</td>
<td>394</td>
<td>302</td>
<td>20</td>
<td>18</td>
<td>11</td>
<td>9</td>
<td>167</td>
<td>48</td>
<td>49</td>
<td>59.0</td>
<td>227</td>
<td>104</td>
<td>5571.0</td>
<td>6</td>
<td>48</td>
<td>39</td>
<td>1645</td>
<td>23.0</td>
<td>86.0</td>
<td>62</td>
<td>13.0</td>
<td>69.0</td>
<td>256</td>
</tr>
<tr>
<td>3622</td>
<td>2018-08-26</td>
<td>2018</td>
<td>West Coast</td>
<td>Brisbane</td>
<td>1548</td>
<td>11</td>
<td>5</td>
<td>13.0</td>
<td>49</td>
<td>42</td>
<td>9</td>
<td>141</td>
<td>360</td>
<td>262</td>
<td>18</td>
<td>20</td>
<td>14</td>
<td>8</td>
<td>137</td>
<td>39</td>
<td>56</td>
<td>70.0</td>
<td>223</td>
<td>95</td>
<td>5809.0</td>
<td>12</td>
<td>39</td>
<td>34</td>
<td>1655</td>
<td>29.0</td>
<td>94.0</td>
<td>55</td>
<td>6.0</td>
<td>59.0</td>
<td>217</td>
</tr>
<tr>
<td>3623</td>
<td>2018-08-26</td>
<td>2018</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>1587</td>
<td>8</td>
<td>11</td>
<td>19.0</td>
<td>48</td>
<td>33</td>
<td>7</td>
<td>125</td>
<td>383</td>
<td>299</td>
<td>18</td>
<td>14</td>
<td>14</td>
<td>13</td>
<td>173</td>
<td>23</td>
<td>48</td>
<td>68.0</td>
<td>210</td>
<td>112</td>
<td>5522.0</td>
<td>14</td>
<td>46</td>
<td>35</td>
<td>1568</td>
<td>14.0</td>
<td>95.0</td>
<td>50</td>
<td>7.0</td>
<td>77.0</td>
<td>269</td>
</tr>
<tr>
<td>3624</td>
<td>2018-08-26</td>
<td>2018</td>
<td>GWS</td>
<td>Melbourne</td>
<td>1449</td>
<td>7</td>
<td>17</td>
<td>14.0</td>
<td>42</td>
<td>31</td>
<td>12</td>
<td>111</td>
<td>355</td>
<td>274</td>
<td>19</td>
<td>13</td>
<td>8</td>
<td>7</td>
<td>159</td>
<td>18</td>
<td>50</td>
<td>54.0</td>
<td>196</td>
<td>110</td>
<td>5416.0</td>
<td>10</td>
<td>62</td>
<td>34</td>
<td>1532</td>
<td>17.0</td>
<td>78.0</td>
<td>46</td>
<td>5.0</td>
<td>58.0</td>
<td>254</td>
</tr>
<tr>
<td>3625</td>
<td>2018-08-26</td>
<td>2018</td>
<td>Melbourne</td>
<td>GWS</td>
<td>1712</td>
<td>8</td>
<td>12</td>
<td>10.0</td>
<td>38</td>
<td>30</td>
<td>12</td>
<td>139</td>
<td>403</td>
<td>302</td>
<td>13</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>181</td>
<td>48</td>
<td>54</td>
<td>59.0</td>
<td>222</td>
<td>106</td>
<td>6198.0</td>
<td>16</td>
<td>34</td>
<td>39</td>
<td>1768</td>
<td>20.0</td>
<td>147.0</td>
<td>60</td>
<td>2.0</td>
<td>53.0</td>
<td>269</td>
</tr>
</tbody>
</table>
<p>We now have a three fully prepared DataFrames which are almost ready to be analysed and for a model to be built on! Let's have a look at how they look and then merge them together into our final DataFrame.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>odds<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>team</th>
<th>odds</th>
<th>date</th>
<th>home_game</th>
</tr>
</thead>
<tbody>
<tr>
<td>4179</td>
<td>Box Hill Hawks</td>
<td>1.4300</td>
<td>2018-09-01</td>
<td>1</td>
</tr>
<tr>
<td>4180</td>
<td>Casey Demons</td>
<td>1.9000</td>
<td>2018-09-01</td>
<td>1</td>
</tr>
<tr>
<td>4181</td>
<td>West Perth</td>
<td>2.7382</td>
<td>2018-09-01</td>
<td>0</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>match_results<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>game</th>
<th>date</th>
<th>round</th>
<th>team</th>
<th>goals</th>
<th>behinds</th>
<th>points</th>
<th>margin</th>
<th>venue</th>
<th>opponent</th>
<th>opponent_goals</th>
<th>opponent_behinds</th>
<th>opponent_points</th>
<th>home_game</th>
</tr>
</thead>
<tbody>
<tr>
<td>30793</td>
<td>15397</td>
<td>2018-08-26</td>
<td>23</td>
<td>Melbourne</td>
<td>15</td>
<td>12</td>
<td>102</td>
<td>45</td>
<td>M.C.G.</td>
<td>GWS</td>
<td>8</td>
<td>9</td>
<td>57</td>
<td>1</td>
</tr>
<tr>
<td>30794</td>
<td>15398</td>
<td>2018-08-26</td>
<td>23</td>
<td>St Kilda</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>-23</td>
<td>Docklands</td>
<td>North Melbourne</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>1</td>
</tr>
<tr>
<td>30795</td>
<td>15398</td>
<td>2018-08-26</td>
<td>23</td>
<td>North Melbourne</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>23</td>
<td>Docklands</td>
<td>St Kilda</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>0</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>agg_stats<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>season</th>
<th>team</th>
<th>opponent</th>
<th>AF</th>
<th>B</th>
<th>BO</th>
<th>CCL</th>
<th>CG</th>
<th>CL</th>
<th>CM</th>
<th>CP</th>
<th>D</th>
<th>ED</th>
<th>FA</th>
<th>FF</th>
<th>G</th>
<th>GA</th>
<th>HB</th>
<th>HO</th>
<th>I50</th>
<th>ITC</th>
<th>K</th>
<th>M</th>
<th>MG</th>
<th>MI5</th>
<th>One.Percenters</th>
<th>R50</th>
<th>SC</th>
<th>SCL</th>
<th>SI</th>
<th>T</th>
<th>T5</th>
<th>TO</th>
<th>UP</th>
</tr>
</thead>
<tbody>
<tr>
<td>3623</td>
<td>2018-08-26</td>
<td>2018</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>1587</td>
<td>8</td>
<td>11</td>
<td>19.0</td>
<td>48</td>
<td>33</td>
<td>7</td>
<td>125</td>
<td>383</td>
<td>299</td>
<td>18</td>
<td>14</td>
<td>14</td>
<td>13</td>
<td>173</td>
<td>23</td>
<td>48</td>
<td>68.0</td>
<td>210</td>
<td>112</td>
<td>5522.0</td>
<td>14</td>
<td>46</td>
<td>35</td>
<td>1568</td>
<td>14.0</td>
<td>95.0</td>
<td>50</td>
<td>7.0</td>
<td>77.0</td>
<td>269</td>
</tr>
<tr>
<td>3624</td>
<td>2018-08-26</td>
<td>2018</td>
<td>GWS</td>
<td>Melbourne</td>
<td>1449</td>
<td>7</td>
<td>17</td>
<td>14.0</td>
<td>42</td>
<td>31</td>
<td>12</td>
<td>111</td>
<td>355</td>
<td>274</td>
<td>19</td>
<td>13</td>
<td>8</td>
<td>7</td>
<td>159</td>
<td>18</td>
<td>50</td>
<td>54.0</td>
<td>196</td>
<td>110</td>
<td>5416.0</td>
<td>10</td>
<td>62</td>
<td>34</td>
<td>1532</td>
<td>17.0</td>
<td>78.0</td>
<td>46</td>
<td>5.0</td>
<td>58.0</td>
<td>254</td>
</tr>
<tr>
<td>3625</td>
<td>2018-08-26</td>
<td>2018</td>
<td>Melbourne</td>
<td>GWS</td>
<td>1712</td>
<td>8</td>
<td>12</td>
<td>10.0</td>
<td>38</td>
<td>30</td>
<td>12</td>
<td>139</td>
<td>403</td>
<td>302</td>
<td>13</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>181</td>
<td>48</td>
<td>54</td>
<td>59.0</td>
<td>222</td>
<td>106</td>
<td>6198.0</td>
<td>16</td>
<td>34</td>
<td>39</td>
<td>1768</td>
<td>20.0</td>
<td>147.0</td>
<td>60</td>
<td>2.0</td>
<td>53.0</td>
<td>269</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>merged_df <span style="color: #666666">=</span> (odds[odds<span style="color: #666666">.</span>team<span style="color: #666666">.</span>isin(agg_stats<span style="color: #666666">.</span>team<span style="color: #666666">.</span>unique())]
                <span style="color: #666666">.</span>pipe(pd<span style="color: #666666">.</span>merge, match_results, on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;home_game&#39;</span>])
                <span style="color: #666666">.</span>pipe(pd<span style="color: #666666">.</span>merge, agg_stats, on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;opponent&#39;</span>])
                <span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;game&#39;</span>]))
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>merged_df<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>team</th>
<th>odds</th>
<th>date</th>
<th>home_game</th>
<th>game</th>
<th>round</th>
<th>goals</th>
<th>behinds</th>
<th>points</th>
<th>margin</th>
<th>venue</th>
<th>opponent</th>
<th>opponent_goals</th>
<th>opponent_behinds</th>
<th>opponent_points</th>
<th>season</th>
<th>AF</th>
<th>B</th>
<th>BO</th>
<th>CCL</th>
<th>CG</th>
<th>CL</th>
<th>CM</th>
<th>CP</th>
<th>D</th>
<th>ED</th>
<th>FA</th>
<th>FF</th>
<th>G</th>
<th>GA</th>
<th>HB</th>
<th>HO</th>
<th>I50</th>
<th>ITC</th>
<th>K</th>
<th>M</th>
<th>MG</th>
<th>MI5</th>
<th>One.Percenters</th>
<th>R50</th>
<th>SC</th>
<th>SCL</th>
<th>SI</th>
<th>T</th>
<th>T5</th>
<th>TO</th>
<th>UP</th>
</tr>
</thead>
<tbody>
<tr>
<td>3199</td>
<td>Melbourne</td>
<td>1.5116</td>
<td>2018-08-26</td>
<td>1</td>
<td>15397</td>
<td>23</td>
<td>15</td>
<td>12</td>
<td>102</td>
<td>45</td>
<td>M.C.G.</td>
<td>GWS</td>
<td>8</td>
<td>9</td>
<td>57</td>
<td>2018</td>
<td>1712</td>
<td>8</td>
<td>12</td>
<td>10.0</td>
<td>38</td>
<td>30</td>
<td>12</td>
<td>139</td>
<td>403</td>
<td>302</td>
<td>13</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>181</td>
<td>48</td>
<td>54</td>
<td>59.0</td>
<td>222</td>
<td>106</td>
<td>6198.0</td>
<td>16</td>
<td>34</td>
<td>39</td>
<td>1768</td>
<td>20.0</td>
<td>147.0</td>
<td>60</td>
<td>2.0</td>
<td>53.0</td>
<td>269</td>
</tr>
<tr>
<td>3195</td>
<td>North Melbourne</td>
<td>1.3936</td>
<td>2018-08-26</td>
<td>0</td>
<td>15398</td>
<td>23</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>23</td>
<td>Docklands</td>
<td>St Kilda</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>2018</td>
<td>1707</td>
<td>13</td>
<td>7</td>
<td>15.0</td>
<td>50</td>
<td>24</td>
<td>6</td>
<td>131</td>
<td>425</td>
<td>322</td>
<td>14</td>
<td>18</td>
<td>17</td>
<td>13</td>
<td>201</td>
<td>32</td>
<td>59</td>
<td>77.0</td>
<td>224</td>
<td>106</td>
<td>5833.0</td>
<td>23</td>
<td>33</td>
<td>29</td>
<td>1735</td>
<td>9.0</td>
<td>154.0</td>
<td>48</td>
<td>9.0</td>
<td>66.0</td>
<td>300</td>
</tr>
<tr>
<td>3200</td>
<td>St Kilda</td>
<td>3.5178</td>
<td>2018-08-26</td>
<td>1</td>
<td>15398</td>
<td>23</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>-23</td>
<td>Docklands</td>
<td>North Melbourne</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>2018</td>
<td>1587</td>
<td>8</td>
<td>11</td>
<td>19.0</td>
<td>48</td>
<td>33</td>
<td>7</td>
<td>125</td>
<td>383</td>
<td>299</td>
<td>18</td>
<td>14</td>
<td>14</td>
<td>13</td>
<td>173</td>
<td>23</td>
<td>48</td>
<td>68.0</td>
<td>210</td>
<td>112</td>
<td>5522.0</td>
<td>14</td>
<td>46</td>
<td>35</td>
<td>1568</td>
<td>14.0</td>
<td>95.0</td>
<td>50</td>
<td>7.0</td>
<td>77.0</td>
<td>269</td>
</tr>
</tbody>
</table>
<p>Great! We now have a clean looking datset with each row representing one team in a game. Let's now eliminate the outliers from a dataset. We know that Essendon had a doping scandal which resulted in their entire team being banned for a year in 2016, so let's remove all of their 2016 games. To do this we will filter based on the team and season, and then invert this with ~.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Define a function which eliminates outliers</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">outlier_eliminator</span>(df):
    <span style="color: #408080; font-style: italic"># Eliminate Essendon 2016 games</span>
    essendon_filter_criteria <span style="color: #666666">=</span> <span style="color: #666666">~</span>(((df[<span style="color: #BA2121">&#39;team&#39;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;Essendon&#39;</span>) <span style="color: #666666">&amp;</span> (df[<span style="color: #BA2121">&#39;season&#39;</span>] <span style="color: #666666">==</span> <span style="color: #666666">2016</span>)) <span style="color: #666666">|</span> ((df[<span style="color: #BA2121">&#39;opponent&#39;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;Essendon&#39;</span>) <span style="color: #666666">&amp;</span> (df[<span style="color: #BA2121">&#39;season&#39;</span>] <span style="color: #666666">==</span> <span style="color: #666666">2016</span>)))
    df <span style="color: #666666">=</span> df[essendon_filter_criteria]<span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>)

    <span style="color: #008000; font-weight: bold">return</span> df
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>afl_data <span style="color: #666666">=</span> outlier_eliminator(merged_df)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>afl_data<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>team</th>
<th>odds</th>
<th>date</th>
<th>home_game</th>
<th>game</th>
<th>round</th>
<th>goals</th>
<th>behinds</th>
<th>points</th>
<th>margin</th>
<th>venue</th>
<th>opponent</th>
<th>opponent_goals</th>
<th>opponent_behinds</th>
<th>opponent_points</th>
<th>season</th>
<th>AF</th>
<th>B</th>
<th>BO</th>
<th>CCL</th>
<th>CG</th>
<th>CL</th>
<th>CM</th>
<th>CP</th>
<th>D</th>
<th>ED</th>
<th>FA</th>
<th>FF</th>
<th>G</th>
<th>GA</th>
<th>HB</th>
<th>HO</th>
<th>I50</th>
<th>ITC</th>
<th>K</th>
<th>M</th>
<th>MG</th>
<th>MI5</th>
<th>One.Percenters</th>
<th>R50</th>
<th>SC</th>
<th>SCL</th>
<th>SI</th>
<th>T</th>
<th>T5</th>
<th>TO</th>
<th>UP</th>
</tr>
</thead>
<tbody>
<tr>
<td>3154</td>
<td>Melbourne</td>
<td>1.5116</td>
<td>2018-08-26</td>
<td>1</td>
<td>15397</td>
<td>23</td>
<td>15</td>
<td>12</td>
<td>102</td>
<td>45</td>
<td>M.C.G.</td>
<td>GWS</td>
<td>8</td>
<td>9</td>
<td>57</td>
<td>2018</td>
<td>1712</td>
<td>8</td>
<td>12</td>
<td>10.0</td>
<td>38</td>
<td>30</td>
<td>12</td>
<td>139</td>
<td>403</td>
<td>302</td>
<td>13</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>181</td>
<td>48</td>
<td>54</td>
<td>59.0</td>
<td>222</td>
<td>106</td>
<td>6198.0</td>
<td>16</td>
<td>34</td>
<td>39</td>
<td>1768</td>
<td>20.0</td>
<td>147.0</td>
<td>60</td>
<td>2.0</td>
<td>53.0</td>
<td>269</td>
</tr>
<tr>
<td>3155</td>
<td>North Melbourne</td>
<td>1.3936</td>
<td>2018-08-26</td>
<td>0</td>
<td>15398</td>
<td>23</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>23</td>
<td>Docklands</td>
<td>St Kilda</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>2018</td>
<td>1707</td>
<td>13</td>
<td>7</td>
<td>15.0</td>
<td>50</td>
<td>24</td>
<td>6</td>
<td>131</td>
<td>425</td>
<td>322</td>
<td>14</td>
<td>18</td>
<td>17</td>
<td>13</td>
<td>201</td>
<td>32</td>
<td>59</td>
<td>77.0</td>
<td>224</td>
<td>106</td>
<td>5833.0</td>
<td>23</td>
<td>33</td>
<td>29</td>
<td>1735</td>
<td>9.0</td>
<td>154.0</td>
<td>48</td>
<td>9.0</td>
<td>66.0</td>
<td>300</td>
</tr>
<tr>
<td>3156</td>
<td>St Kilda</td>
<td>3.5178</td>
<td>2018-08-26</td>
<td>1</td>
<td>15398</td>
<td>23</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>-23</td>
<td>Docklands</td>
<td>North Melbourne</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>2018</td>
<td>1587</td>
<td>8</td>
<td>11</td>
<td>19.0</td>
<td>48</td>
<td>33</td>
<td>7</td>
<td>125</td>
<td>383</td>
<td>299</td>
<td>18</td>
<td>14</td>
<td>14</td>
<td>13</td>
<td>173</td>
<td>23</td>
<td>48</td>
<td>68.0</td>
<td>210</td>
<td>112</td>
<td>5522.0</td>
<td>14</td>
<td>46</td>
<td>35</td>
<td>1568</td>
<td>14.0</td>
<td>95.0</td>
<td>50</td>
<td>7.0</td>
<td>77.0</td>
<td>269</td>
</tr>
</tbody>
</table>
<p>Finally, let's mark all of the columns that we are going to use in feature creation with the string 'f_' at the start of their column name so that we can easily filter for these columns.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>non_feature_cols <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;home_game&#39;</span>, <span style="color: #BA2121">&#39;game&#39;</span>, <span style="color: #BA2121">&#39;round&#39;</span>, <span style="color: #BA2121">&#39;venue&#39;</span>, <span style="color: #BA2121">&#39;opponent&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>]
afl_data <span style="color: #666666">=</span> afl_data<span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{col: <span style="color: #BA2121">&#39;f_&#39;</span> <span style="color: #666666">+</span> col <span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> afl_data <span style="color: #008000; font-weight: bold">if</span> col <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #AA22FF; font-weight: bold">in</span> non_feature_cols})
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>afl_data<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>team</th>
<th>f_odds</th>
<th>date</th>
<th>home_game</th>
<th>game</th>
<th>round</th>
<th>f_goals</th>
<th>f_behinds</th>
<th>f_points</th>
<th>f_margin</th>
<th>venue</th>
<th>opponent</th>
<th>f_opponent_goals</th>
<th>f_opponent_behinds</th>
<th>f_opponent_points</th>
<th>season</th>
<th>f_AF</th>
<th>f_B</th>
<th>f_BO</th>
<th>f_CCL</th>
<th>f_CG</th>
<th>f_CL</th>
<th>f_CM</th>
<th>f_CP</th>
<th>f_D</th>
<th>f_ED</th>
<th>f_FA</th>
<th>f_FF</th>
<th>f_G</th>
<th>f_GA</th>
<th>f_HB</th>
<th>f_HO</th>
<th>f_I50</th>
<th>f_ITC</th>
<th>f_K</th>
<th>f_M</th>
<th>f_MG</th>
<th>f_MI5</th>
<th>f_One.Percenters</th>
<th>f_R50</th>
<th>f_SC</th>
<th>f_SCL</th>
<th>f_SI</th>
<th>f_T</th>
<th>f_T5</th>
<th>f_TO</th>
<th>f_UP</th>
</tr>
</thead>
<tbody>
<tr>
<td>3154</td>
<td>Melbourne</td>
<td>1.5116</td>
<td>2018-08-26</td>
<td>1</td>
<td>15397</td>
<td>23</td>
<td>15</td>
<td>12</td>
<td>102</td>
<td>45</td>
<td>M.C.G.</td>
<td>GWS</td>
<td>8</td>
<td>9</td>
<td>57</td>
<td>2018</td>
<td>1712</td>
<td>8</td>
<td>12</td>
<td>10.0</td>
<td>38</td>
<td>30</td>
<td>12</td>
<td>139</td>
<td>403</td>
<td>302</td>
<td>13</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>181</td>
<td>48</td>
<td>54</td>
<td>59.0</td>
<td>222</td>
<td>106</td>
<td>6198.0</td>
<td>16</td>
<td>34</td>
<td>39</td>
<td>1768</td>
<td>20.0</td>
<td>147.0</td>
<td>60</td>
<td>2.0</td>
<td>53.0</td>
<td>269</td>
</tr>
<tr>
<td>3155</td>
<td>North Melbourne</td>
<td>1.3936</td>
<td>2018-08-26</td>
<td>0</td>
<td>15398</td>
<td>23</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>23</td>
<td>Docklands</td>
<td>St Kilda</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>2018</td>
<td>1707</td>
<td>13</td>
<td>7</td>
<td>15.0</td>
<td>50</td>
<td>24</td>
<td>6</td>
<td>131</td>
<td>425</td>
<td>322</td>
<td>14</td>
<td>18</td>
<td>17</td>
<td>13</td>
<td>201</td>
<td>32</td>
<td>59</td>
<td>77.0</td>
<td>224</td>
<td>106</td>
<td>5833.0</td>
<td>23</td>
<td>33</td>
<td>29</td>
<td>1735</td>
<td>9.0</td>
<td>154.0</td>
<td>48</td>
<td>9.0</td>
<td>66.0</td>
<td>300</td>
</tr>
<tr>
<td>3156</td>
<td>St Kilda</td>
<td>3.5178</td>
<td>2018-08-26</td>
<td>1</td>
<td>15398</td>
<td>23</td>
<td>14</td>
<td>10</td>
<td>94</td>
<td>-23</td>
<td>Docklands</td>
<td>North Melbourne</td>
<td>17</td>
<td>15</td>
<td>117</td>
<td>2018</td>
<td>1587</td>
<td>8</td>
<td>11</td>
<td>19.0</td>
<td>48</td>
<td>33</td>
<td>7</td>
<td>125</td>
<td>383</td>
<td>299</td>
<td>18</td>
<td>14</td>
<td>14</td>
<td>13</td>
<td>173</td>
<td>23</td>
<td>48</td>
<td>68.0</td>
<td>210</td>
<td>112</td>
<td>5522.0</td>
<td>14</td>
<td>46</td>
<td>35</td>
<td>1568</td>
<td>14.0</td>
<td>95.0</td>
<td>50</td>
<td>7.0</td>
<td>77.0</td>
<td>269</td>
</tr>
</tbody>
</table>
<p>Our data is now fully ready to be explored and for features to be created, which we will walk you through in our next tutorial, <a href="/modelling/AFLmodelPart2">AFL Feature Creation Tutorial</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../EPLmodelPart4/" title="EPL 04. Weekly predictions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                EPL 04. Weekly predictions
              </span>
            </div>
          </a>
        
        
          <a href="../AFLmodelPart2/" title="AFL 02. Feature creation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                AFL 02. Feature creation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/Betfair_Aus" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/company/betfair-australia" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://facebook.com/betfairaustralia" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://youtube.com/user/betfairaus" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://github.com/betfair-datascientists" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
    <div class="bf-footer">
      <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
      <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its Responsible Gambling Code of Conduct and for South
      Australian residents by the South Australian Responsible Gambling Code of Practice.<br> Think! About your choices. Think of the people who need your support. Gamble responsibly. Call Gambling Help 1800 858 858 <a href="https://gamblinghelponline.org.au">www.gamblinghelponline.org.au</a></p>
      <ul class="bf-links">
        <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
        <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
        <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
        <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
        <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
      </ul>
    </div>
  </div>
  <script src="https://js.adsrvr.org/up_loader.1.1.0.js"></script>
  <script>ttd_dom_ready(function(){"function"==typeof TTDUniversalPixelApi&&(new TTDUniversalPixelApi).init("y12d1ir",["8ml4f17"],"https://insight.adsrvr.org/track/up")})</script>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.72d6715c.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125973915-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>